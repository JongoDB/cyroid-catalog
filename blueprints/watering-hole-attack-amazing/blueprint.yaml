# CYROID Watering Hole Attack Amazing Blueprint
# Client-side exploitation training with Sliver C2
seed_id: watering-hole-attack-amazing
name: Watering Hole Attack Amazing
description: |
  Demonstrates client-side exploitation via a watering hole attack.
  A victim Windows 11 workstation browses to a compromised weather website
  (sliver-weather), downloads a trojanized application containing a Sliver C2
  implant, which calls back to the listening post. A blue-space Ubuntu operator
  machine manages the C2 sessions.

  Purpose: Train IT staff on how client exploitation works.

  Attack Flow:
  1. Victim browses to weather website (watering hole)
  2. Downloads trojanized "AtmosVision Pro" installer
  3. Implant executes and calls back to Sliver C2 listening post
  4. Operator manages C2 sessions from blue-space Ubuntu desktop

  Network Segments:
  - User Space: Corporate victim workstation
  - DMZ: Watering hole website / C2 listening post
  - Blue Space: C2 operator console (isolated management network)

  VMs:
  - Windows 11 Pro x86_64 (victim workstation)
  - Sliver-Weather all-in-one (nginx + weather app + Sliver C2)
  - Ubuntu KasmVNC Desktop (C2 operator with Sliver client)

version: "1.0"
base_subnet_prefix: "10.100"

requires_base_images:
  - windows-11-pro

networks:
  - name: user-space
    subnet: "10.100.0.0/24"
    gateway: "10.100.0.1"
    is_isolated: true
    internet_enabled: false
    dhcp_enabled: false

  - name: dmz
    subnet: "10.100.1.0/24"
    gateway: "10.100.1.1"
    is_isolated: true
    internet_enabled: false
    dhcp_enabled: false

  - name: blue-space
    subnet: "10.100.2.0/24"
    gateway: "10.100.2.1"
    is_isolated: true
    internet_enabled: false
    dhcp_enabled: false

vms:
  # ==========================================================================
  # USER SPACE (10.100.0.0/24) - Victim workstation
  # ==========================================================================

  # Windows 11 victim - browses to watering hole, downloads and runs implant
  - hostname: victim-ws
    os_type: windows
    vm_type: windows_vm
    windows_version: "11"
    arch: x86_64
    base_image_tag: "dockurr/windows"
    network_interfaces:
      - network_name: user-space
        ip_address: "10.100.0.10"
        is_primary: true
    cpu: 4
    ram_mb: 8192
    disk_gb: 64
    display_type: desktop
    windows_username: "Trainee"
    windows_password: "Training123!"
    use_dhcp: false
    gateway: "10.100.0.1"
    dns_servers: "10.100.1.10"
    environment:
      VERSION: "11"
      DISK_SIZE: "64G"
      CPU_CORES: "4"
      RAM_SIZE: "8192M"
    position_x: 100
    position_y: 300

  # ==========================================================================
  # DMZ (10.100.1.0/24) + BLUE SPACE (10.100.2.0/24) - Listening post
  # ==========================================================================

  # Sliver-weather: watering hole site + C2 listener
  # Multi-homed: DMZ (victim-facing) + Blue Space (operator management)
  - hostname: sliver-weather
    os_type: linux
    vm_type: container
    arch: x86_64
    base_image_tag: "cyroid/sliver-weather:latest"
    network_interfaces:
      - network_name: dmz
        ip_address: "10.100.1.10"
        is_primary: true
      - network_name: blue-space
        ip_address: "10.100.2.10"
        is_primary: false
    cpu: 2
    ram_mb: 4096
    disk_gb: 20
    position_x: 400
    position_y: 150

  # ==========================================================================
  # BLUE SPACE (10.100.2.0/24) - C2 operator
  # ==========================================================================

  # Ubuntu desktop with Sliver client for managing C2 sessions
  - hostname: c2-operator
    os_type: linux
    vm_type: container
    arch: x86_64
    base_image_tag: "cyroid/c2-operator:latest"
    network_interfaces:
      - network_name: blue-space
        ip_address: "10.100.2.20"
        is_primary: true
    cpu: 2
    ram_mb: 4096
    disk_gb: 20
    position_x: 700
    position_y: 300

router:
  enabled: true
  dhcp_enabled: false

# Training scenario events (MSEL)
events:
  - sequence: 1
    delay_minutes: 0
    title: "Phase 1: Setup & Verification"
    description: |
      Verify all VMs are running. From c2-operator (10.100.2.20), confirm
      connectivity to sliver-weather (10.100.2.10). Verify weather website
      loads at http://10.100.1.10 from victim-ws.

  - sequence: 2
    delay_minutes: 10
    title: "Phase 2: Configure C2 Listener"
    description: |
      On c2-operator, import the operator config from the listening post
      and connect to Sliver. Start an mTLS listener on the DMZ interface
      (10.100.1.10:31337). Generate a Windows implant.

  - sequence: 3
    delay_minutes: 20
    title: "Phase 3: Stage the Implant"
    description: |
      Stage the generated implant on the weather site download endpoint.
      Verify the download link works from the victim network.

  - sequence: 4
    delay_minutes: 30
    title: "Phase 4: Victim Browses to Watering Hole"
    description: |
      On victim-ws, open browser and navigate to http://10.100.1.10.
      Browse the weather site - note its legitimate appearance.

  - sequence: 5
    delay_minutes: 35
    title: "Phase 5: Victim Downloads Trojanized App"
    description: |
      On victim-ws, click the "AtmosVision Pro" download link.
      Run the downloaded installer. The weather app installs while
      the implant executes silently in the background.

  - sequence: 6
    delay_minutes: 45
    title: "Phase 6: Observe C2 Callback"
    description: |
      On c2-operator, observe the Sliver console for a new session
      from 10.100.0.10. Run 'sessions' to list active sessions.

  - sequence: 7
    delay_minutes: 50
    title: "Phase 7: Demonstrate C2 Capabilities"
    description: |
      Interact with the session: whoami, info, ls, screenshot.
      Demonstrate post-exploitation access to the victim workstation.

  - sequence: 8
    delay_minutes: 60
    title: "Phase 8: Kill Chain Review & Defense Discussion"
    description: |
      Walk through the full kill chain (recon, weaponization, delivery,
      exploitation, installation, C2, actions on objectives).
      Discuss defenses: app whitelisting, EDR, network monitoring,
      DNS filtering, user awareness, code signing, browser isolation.
